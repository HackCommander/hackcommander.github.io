<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.15.1 by Michael Rose
  Copyright 2013-2019 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Breaking the perimeter by exploiting routing-based SSRF via a misconfigured load balancer - hackcommander.github.io</title>
<meta name="description" content="Partial disclosure of a bug bounty report: breaking the perimeter by exploiting routing-based SSRF via a misconfigured load balancer.">



<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="hackcommander.github.io">
<meta property="og:title" content="Breaking the perimeter by exploiting routing-based SSRF via a misconfigured load balancer">
<meta property="og:url" content="https://hackcommander.github.io/posts/2024/12/07/breaking-the-perimeter-by-exploiting-routing-based-ssrf-via-a-misconfigured-load-balancer/">


  <meta property="og:description" content="Partial disclosure of a bug bounty report: breaking the perimeter by exploiting routing-based SSRF via a misconfigured load balancer.">



  <meta property="og:image" content="https://hackcommander.github.io/assets/images/general/bug-bounty.jpg">





  <meta property="article:published_time" content="2024-12-07T00:00:00+01:00">





  

  


<link rel="canonical" href="https://hackcommander.github.io/posts/2024/12/07/breaking-the-perimeter-by-exploiting-routing-based-ssrf-via-a-misconfigured-load-balancer/">







  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Person",
      "name": "Iván Santos Malpica",
      "url": "https://hackcommander.github.io",
      "sameAs": null
    }
  </script>







<!-- end _includes/seo.html -->


<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="hackcommander.github.io Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">

<!--[if IE ]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

    
  </head>

  <body class="layout--single wide">

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
          <a class="site-logo" href="/"><img src="/assets/images/masthead.png" alt=""></a>
                
        <ul class="visible-links">
<li class="masthead__menu-item">
              <a href="/">Home</a>
            </li>
<li class="masthead__menu-item">
              <a href="/year-archive/">Posts</a>
            </li>
<li class="masthead__menu-item">
              <a href="/categories/">Categories</a>
            </li>
<li class="masthead__menu-item">
              <a href="/tags/">Tags</a>
            </li>
<li class="masthead__menu-item">
              <a href="/search/">Search</a>
            </li>
<li class="masthead__menu-item">
              <a href="/advertising/">Advertising</a>
            </li>
<li class="masthead__menu-item">
              <a href="/about/">About</a>
            </li>
</ul>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>
    

    <div class="initial-content">
      


  
    



<nav class="breadcrumbs">
  <ol itemscope itemtype="https://schema.org/BreadcrumbList">
    
    
    
      
        <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
          <a href="https://hackcommander.github.io/" itemprop="item"><span itemprop="name">Home</span></a>
          <meta itemprop="position" content="1">
        </li>
        <span class="sep">/</span>
      
      
        
        <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
          <a href="/categories/#posts" itemprop="item"><span itemprop="name">Posts</span></a>
          <meta itemprop="position" content="2">
        </li>
        <span class="sep">/</span>
      
    
      
      
        
        <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
          <a href="/categories/#2024" itemprop="item"><span itemprop="name">2024</span></a>
          <meta itemprop="position" content="3">
        </li>
        <span class="sep">/</span>
      
    
      
      
        
        <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
          <a href="/categories/#12" itemprop="item"><span itemprop="name">12</span></a>
          <meta itemprop="position" content="4">
        </li>
        <span class="sep">/</span>
      
    
      
      
        
        <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
          <a href="/categories/#07" itemprop="item"><span itemprop="name">07</span></a>
          <meta itemprop="position" content="5">
        </li>
        <span class="sep">/</span>
      
    
      
      
        <li class="current">Breaking the perimeter by exploiting routing-based SSRF via a misconfigured load balancer</li>
      
    
  </ol>
</nav>

  


<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  
    <div class="author__avatar">
      

      
        <img src="/assets/images/avatar.png" alt="Iván Santos Malpica&lt;br&gt;(Aka. HackCommander)" itemprop="image">
      
    </div>
  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">Iván Santos Malpica<br>(Aka. HackCommander)</h3>
    
    
      <p class="author__bio" itemprop="description">
        Mathematician and Computer Engineer / Pentester / Bug Bounty Hunter / CTF Player
      </p>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name">Spain</span>
        </li>
      
      
      
        <li>
          <a href="mailto:ivansantosmalpica.contact@gmail.com">
            <meta itemprop="email" content="ivansantosmalpica.contact@gmail.com">
            <i class="fas fa-fw fa-envelope-square" aria-hidden="true"></i> Email
          </a>
        </li>
      
      
      
        <li>
          <a href="https://hackcommander.github.io/assets/misc/2CF9F4B62E06BB2C336989C818B0C19D52075F78.asc" itemprop="sameAs" rel="nofollow noopener noreferrer">
            <img src="/assets/images/author-logos/lock.svg" alt="HackerOne" style="width: 16px; height: 16px;">
            PGP
          </a>
        </li>
      
      
      
        <li>
          <a href="https://www.linkedin.com/in/ivan-santos-malpica" itemprop="sameAs" rel="nofollow noopener noreferrer">
            <i class="fab fa-fw fa-linkedin" aria-hidden="true"></i> LinkedIn
          </a>
        </li>
      
      
      
        <li>
          <a href="https://hackerone.com/hackcommander" target="_blank">
            <img src="/assets/images/author-logos/hackerone.svg" alt="HackerOne" style="width: 16px; height: 16px;">
            HackerOne
          </a>
        </li>
      
      
      
        <li>
          <a href="https://app.yogosha.com/r/hackcommander" target="_blank">
            <img src="/assets/images/author-logos/yogosha.svg" alt="Yogosha" style="width: 16px; height: 16px;">
            Yogosha
          </a>
        </li>
      
      
      
        <li>
          <a href="https://yeswehack.com/hunters/hackcommander" target="_blank">
            <img src="/assets/images/author-logos/yeswehack.png" alt="Yogosha" style="width: 16px; height: 16px;">
            YesWeHack
          </a>
        </li>
      
      
      
        <li>
          <a href="https://twitter.com/H4ckC0mm4nd3r" itemprop="sameAs" rel="nofollow noopener noreferrer">
            <i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter
          </a>
        </li>
      
      
      
        
          <li>
            <a href="https://www.youtube.com/@ivansantosmalpica" itemprop="sameAs" rel="nofollow noopener noreferrer">
              <i class="fab fa-fw fa-youtube" aria-hidden="true"></i> YouTube
            </a>
          </li>
        
      

      

      

      

      

      

      

      

      

      

      
        <li>
          <a href="https://github.com/hackcommander" itemprop="sameAs" rel="nofollow noopener noreferrer">
            <i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub
          </a>
        </li>
      

      

      

      

      

      

      

      

      

      

      

      

      
      
      
        <li>
          <a href="https://tryhackme.com/p/HackCommander" target="_blank">
            <img src="/assets/images/author-logos/tryhackme.svg" alt="TryHackMe" style="width: 15px; height: 15px;">
            TryHackMe
          </a>
        </li>
      
      
      
        <li>
          <a href="https://app.hackthebox.com/profile/270539" target="_blank">
            <img src="/assets/images/author-logos/hackthebox.svg" alt="HackTheBox" style="width: 15px; height: 15px;">
            HackTheBox
          </a>
        </li>
      
      
      
        <li>
          <a href="https://www.codewars.com/users/HackCommander" target="_blank">
            <img src="/assets/images/author-logos/codewars.svg" alt="CodeWars" style="width: 15px; height: 15px;">
            CodeWars
          </a>
        </li>
      

      
        <li>
          <a href="https://www.buymeacoffee.com/ivansantos" target="_blank">
            <img src="/assets/images/author-logos/buymeacoffee.svg" alt="Buy Me a Coffee" style="width: 16px; height: 16px;">
            Buy Me a Coffee
          </a>
        </li>
      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>


  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Breaking the perimeter by exploiting routing-based SSRF via a misconfigured load balancer">
    <meta itemprop="description" content="Partial disclosure of a bug bounty report: breaking the perimeter by exploiting routing-based SSRF via a misconfigured load balancer.">
    <meta itemprop="datePublished" content="December 07, 2024">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">Breaking the perimeter by exploiting routing-based SSRF via a misconfigured load balancer
</h1>
          
        </header>
      

      <section class="page__content" itemprop="text">
        
        <p class="page__meta">
          
            <i class="fa fa-fw fa-calendar" aria-hidden="true"></i> <time datetime="2024-12-07T00:00:00+01:00">December 07, 2024 </time> 
          
          
        </p>
        <h2 id="summary">Summary</h2>

<ul>
  <li><a href="#section-id-1">1. Asset discovery</a></li>
  <li><a href="#section-id-2">2. Vulnerability discovery</a></li>
  <li>
<a href="#section-id-3">3. Vulnerability exploitation</a>
    <ul>
      <li>
<a href="#section-id-3-1">3.1. Steps of exploitation</a>
        <ul>
          <li><a href="#section-id-3-1-1">3.1.1. Accessing the internal network</a></li>
          <li><a href="#section-id-3-1-2">3.1.2. Scanning the internal network</a></li>
        </ul>
      </li>
      <li><a href="#section-id-3-2">3.2. Why does this vulnerability exist?</a></li>
    </ul>
  </li>
  <li><a href="#section-id-4">4. Report resolution</a></li>
  <li><a href="#section-id-5">5. Lessons learned</a></li>
</ul>

<p><img src="/assets/images/general/bug-bounty.jpg" alt=""></p>

<blockquote>
  <p><img class="emoji" title=":warning:" alt=":warning:" src="https://github.githubassets.com/images/icons/emoji/unicode/26a0.png" height="20" width="20"> <span style="color:red">This bug was reported in a private program in which it is not allowed to publish the vulnerabilities found. So this is a partial disclosure, only the essential technical details are exposed.</span></p>
</blockquote>

<p>In this post I am going to show a vulnerability that I found some years ago, in my beginnings as a bounty hunter. It is not my most original post and the final impact found was not critical, but as I am always talking about the same vulnerabilities (XSS, SQLi…), I felt like making a post about a somewhat different vulnerability, just to change up my content a bit <img class="emoji" title=":smiley:" alt=":smiley:" src="https://github.githubassets.com/images/icons/emoji/unicode/1f603.png" height="20" width="20">. Besides, it’s always good to look back at bugs found some time ago to draw conclusions and think what could have been done better.</p>

<div id="section-id-1"></div>

<h2 id="1-asset-discovery">1. Asset discovery</h2>

<p>I found this asset through amass + httpx. If you are looking for http services on subdomains of the domain example.com and you have your config file in the path <em>/home/user/.config/amass/config.ini</em>, you can use the following command</p>

<div class="code-header">
  <button class="copy-code-button">
    Copy
  </button>
</div>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">amass enum -brute -d example.com '/home/user/.config/amass/config.ini' | httpx -title -tech-detect -status-code -ip -p 66,80,81,443,445,457,1080,1100,1241,1352,1433,1434,1521,1944,2301,3000,3128,3306,4000,4001,4002,4100,5000,5432,5800,5801,5802,6082,6346,6347,7001,7002,8080,8443,8888,30821
</span></code></pre></div></div>

<p><a href="https://github.com/OWASP/Amass">Amass</a> is an OSINT tool to perform network mapping of attack surfaces and external asset discovery which is a very famous tool used in the recon step in bug bounty. The output of the above amass command is a list of subdomains of the given domain, i.e, a list of potential targets.</p>

<p><a href="https://github.com/projectdiscovery/httpx">Httpx</a> is a multi-purpose HTTP toolkit allow to run multiple probers. In this case, the input of httpx is a list of subdomains and the output is a list of subdomains that have an http service in any of the ports given as a parameter. Also it shows some additional information about the service such as the title, the detected technologies… that I have specified in the parameters to be displayed.</p>

<div id="section-id-2"></div>

<h2 id="2-vulnerability-discovery">2. Vulnerability discovery</h2>

<p>The main page worked over HTTP and it didn’t look like a big deal. It only displayed the text <em>It works!</em>, as can be seen in the following evidence:</p>

<p><img src="/assets/images/2024-12-07-breaking-the-perimeter-by-exploiting-routing-based-ssrf-via-a-misconfigured-load-balancer/main-page.png" alt=""></p>

<p>Although it is difficult to decide which part belongs to the discovery and which part belongs to the exploitation, I got the initial clue from the <em>Burp Scanner</em>, as can be seen in the following capture:</p>

<div style="text-align: center;">
  <img src="/assets/images/2024-12-07-breaking-the-perimeter-by-exploiting-routing-based-ssrf-via-a-misconfigured-load-balancer/issue-finding-1.png">
</div>
<p><br></p>

<p>This alert indicates the presence of an <em>External service interaction (DNS)</em> in the server root. This type of alert is usually not a symptom of a vulnerability as it may be due to intentional web functionality and is usually in the <em>Host</em> header of the request. However, it can sometimes allow access to the internal network, as can be seen in the following <em>PortSwigger</em> links:</p>

<ul>
  <li><a href="https://portswigger.net/web-security/host-header/exploiting#routing-based-ssrf">Routing-based SSRF (PortSwigger)</a></li>
  <li><a href="https://portswigger.net/web-security/host-header/exploiting/lab-host-header-routing-based-ssrf">Lab: Routing-based SSRF (PortSwigger)</a></li>
</ul>

<p>However, when I looked at the alert in detail I saw the following:</p>

<div style="text-align: center;">
  <img src="/assets/images/2024-12-07-breaking-the-perimeter-by-exploiting-routing-based-ssrf-via-a-misconfigured-load-balancer/issue-finding-2.png">
</div>
<p><br></p>

<p>As you can see, the injection is not happening in the <em>Host</em> header, but in the HTTP verb path itself. This caught my attention because I had not seen it until then, so to check that it was not a false positive I sent the request again to a new instance of burp collaborator and checked that indeed several DNS requests were coming, as can be seen in the following capture:</p>

<p><img src="/assets/images/2024-12-07-breaking-the-perimeter-by-exploiting-routing-based-ssrf-via-a-misconfigured-load-balancer/burp-collaborator.png" alt=""></p>

<p>In principle, a DNS request to an external server doesn’t mean much. If it were an HTTP request, it would be much more interesting. However, the fact that the request is made using the path and not through the <em>Host</em> header struck me as unusual. That’s why I decided to dig a little deeper here <img class="emoji" title=":mag:" alt=":mag:" src="https://github.githubassets.com/images/icons/emoji/unicode/1f50d.png" height="20" width="20">.</p>

<div id="section-id-3"></div>

<h2 id="3-vulnerability-exploitation">3. Vulnerability exploitation</h2>

<div id="section-id-3-1"></div>

<h2 id="31-steps-of-exploitation">3.1. Steps of exploitation</h2>

<div id="section-id-3-1-1"></div>

<h3 id="311-accessing-the-internal-network">3.1.1. Accessing the internal network</h3>

<p>The main risk of this typec of vulnerability is that it could allow making requests to the internal network. Because of this, I continued investigating the target to see if I could find any private IP addresses disclosed in the HTML, JavaScript, comments, or elsewhere but I found nothing. Burpsuite also didn’t flag anything interesting.</p>

<p>So, I decided to use a tool that I believe isn’t used much in bug bounty hunting: <em>nikto</em>. I executed the following command</p>

<div class="code-header">
  <button class="copy-code-button">
    Copy
  </button>
</div>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">nikto -h http://example.com/
</span></code></pre></div></div>
<p>where the <em>-h</em> option specifies the host.</p>

<p>The result was this:</p>

<p><img src="/assets/images/2024-12-07-breaking-the-perimeter-by-exploiting-routing-based-ssrf-via-a-misconfigured-load-balancer/nikto.png" alt=""></p>

<p>This file is quite interesting because it seems to be the admin interface of a load balancer, specifically for <a href="https://httpd.apache.org/docs/2.4/mod/mod_proxy_balancer.html">Apache Module mod_proxy_balancer</a>. It reveals the following info:</p>

<p><img src="/assets/images/2024-12-07-breaking-the-perimeter-by-exploiting-routing-based-ssrf-via-a-misconfigured-load-balancer/balancer-manager.png" alt=""></p>

<p>This is the Apache balancer manager interface or <em>mod_proxy_balancer</em> module. As you can see, there’s a lot of useful information here, such as potential private IPs that could be used for further exploitation. Additionally, there’s a panel to edit the load balancer’s configuration, something I didn’t test since this was a production system. However, I reported it separately and received a bounty of just over $50 for it.</p>

<p>To confirm whether I could exploit an SSRF, I tested all the private IPs listed. Only one yielded an interesting response, 10.80.3.122, as shown below:</p>

<p><img src="/assets/images/2024-12-07-breaking-the-perimeter-by-exploiting-routing-based-ssrf-via-a-misconfigured-load-balancer/wildfly-1.png" alt=""></p>

<p><em>WildFly Application Server</em> is an open-source, Java-based application server developed by the <em>JBoss Community</em> under the <em>Red Hat umbrella</em>. It is part of the <em>WildFly</em> family and serves as a platform for building, deploying, and hosting <em>Java EE</em> (Enterprise Edition) applications.</p>

<p>The capture above shows how I was able to make a request to the internal network. This confirmed the existence of a routing-based SSRF vulnerability, likely caused by a misconfiguration in the load balancer. It’s essentially an SSRF vulnerability, but instead of being exploited via the Host header, it works through the HTTP verb’s full URL path.</p>

<p>While exploring further, I clicked on the <em>Render</em> tab to get a clearer view of all the possible options. That’s when I discovered there was an admin console available:</p>

<p><img src="/assets/images/2024-12-07-breaking-the-perimeter-by-exploiting-routing-based-ssrf-via-a-misconfigured-load-balancer/wildfly-2.png" alt=""></p>

<p style="text-align:center;"><img src="/assets/images/general/dwight-excitement.gif" style="width: 600px;"></p>

<p>Inspecting the HTML code revealed that the admin console was located at the path <em>/console</em>.</p>

<p><img src="/assets/images/2024-12-07-breaking-the-perimeter-by-exploiting-routing-based-ssrf-via-a-misconfigured-load-balancer/wildfly-3.png" alt=""></p>

<p>Unfortunately, I didn’t save the request in the burp project, but when I tried to access it, I got a response like</p>

<p><em>You don’t have permission to access this resource</em></p>

<p>Damn!</p>

<p style="text-align:center;"><img src="/assets/images/general/dwight-disappointment.gif" style="width: 600px;"></p>

<div id="section-id-3-1-2"></div>

<h3 id="312-scanning-the-internal-network">3.1.2. Scanning the internal network</h3>

<p>As you can see, all the IPs found belong to the Class A network (10.X.X.X or 10.0.0.0/8) and appear to be part of the same subnet (10.80.3.X or 10.80.3.0/24). The recon I could have performed in a situation like this is absolutely crazy:</p>

<ul>
  <li>Available IPs.</li>
  <li>Open ports and running services.</li>
  <li>Specific recon for each service, such as identifying routes and files on HTTP services like the one I found.</li>
</ul>

<p>Although I conducted some recon across these categories, I honestly don’t think I went as deep as I could have, mainly for 3 reasons:</p>

<ul>
  <li>This bug was one of my first findings as a bug bounty hunter.</li>
  <li>Since I was directly interacting with the internal network, I was concerned about being detected by the company’s internal security measures, such as firewalls, IDSs, IDPs… so I chose not to make too much noise.</li>
  <li>The internal network wasn’t explicitly in the program’s scope. While it’s unlikely I would have faced severe consequences, probing too deeply into the internal network might have cjeopardized the bounty or even led to warnings or penalties.</li>
</ul>

<p>Even so, I did a lot of recon through Burpsuite intruder varying IPs, ports, paths… but it would be unfeasible to show all that recon in this post. An example of this recon is the following port scan I performed on the same IP where the <em>WildFly</em> service was running, the IP 10.80.3.122:</p>

<p><img src="/assets/images/2024-12-07-breaking-the-perimeter-by-exploiting-routing-based-ssrf-via-a-misconfigured-load-balancer/port-scan.png" alt=""></p>

<p>Here is some interesting behavior:</p>
<ul>
  <li>
<strong>HTTP codes 200, 301 and 502.</strong> After exploring the responses I came to the conclusion that these responses may correspond to open ports. It is not clear that all the ports associated with this response are open ports but it seems that any open port falls into this category. For example, port 22 has an SSH raised on version <em>SSH-2.0-OpenSSH_5.3</em>.</li>
  <li>
<strong>HTTP code 503</strong>. It seems to be the default HTTP code for closed port and is the code returned by all other ports.</li>
</ul>

<p>In conclusion, I demonstrated that it is possible to run a port scan on the internal network. Specifically, the result shows that IP 10.80.3.122 has potentially open ports 22, 111, 1556, 1556, 3237, 3528, 7777, 8009, 8080, 9990, 9999, 10000, 10050, 13782, 36174, 54186 and 55422.</p>

<p>So since reporting something like</p>

<p><em>Exposure of an internal *WildFly</em> service*</p>

<p>felt too specific and challenging to explain in terms of impact, I decided to approach the issue from a broader and more impactful perspective. I reported it as</p>

<p><em>Routing-based SSRF on the balancer allows access to and scanning of the internal network</em></p>

<div id="section-id-3-2"></div>

<h2 id="32-why-does-this-vulnerability-exist">3.2. Why does this vulnerability exist?</h2>

<p>In summary, the fundamental reason is that the <em>Apache Balancer</em> is either misconfigured or running with its default configuration. This vulnerability could be broken down into two misconfigurations:</p>

<ul>
  <li>
    <p><strong>Exposed Apache balancer manager interface.</strong> The Apache balancer manager interface is exposed to the internet when its access should be restricted through authentication or limited to internal network or VPN access. This could be mitigated by adding a directive like the following to the Apache configuration:</p>

    <div class="code-header">
  <button class="copy-code-button">
    Copy
  </button>
</div>
    <div class="language-plaintext highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>&lt;Location "/balancer-manager"&gt;
  Require ip 10.0.0.0/8
  Require all denied
&lt;/Location&gt;
</code></pre></div>    </div>

    <p>This directive allows access to the <em>/balancer-manager</em> path <strong>only</strong> from IP addresses in the 10.0.0.0/8 range.</p>
  </li>
  <li>
    <p><strong>Incorrect routing to internal assets.</strong> The balancer allows requests to be made to both external and internal network assets. This could be due to misconfiguration of directives like <em>ProxyRequests</em>, <em>ProxyPass</em> or <em>ProxyPassReverse</em> in the Apache configuration. For instance, when <em>ProxyRequests</em> is enabled, as shown in the following directive</p>

    <div class="code-header">
  <button class="copy-code-button">
    Copy
  </button>
</div>
    <div class="language-plaintext highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>ProxyRequests On
</code></pre></div>    </div>

    <p>Apache allows the use of full URLs and acts as an open proxy.</p>
  </li>
</ul>

<p>These are just theories but align with the observed behavior of the vulnerability.</p>

<div id="section-id-4"></div>

<h2 id="4-report-resolution">4. Report resolution</h2>

<p>As I said before, the subdomain was not important so it was classified as low criticity. In addition, although I was not able to demonstrate a significant impact, the simple fact of gaining access to the internal network was enough for them to classify it as a vulnerability of high severity because of the consequences that it could have in the future if they decide to add other important assets to the network. Therefore, the report was classified as</p>

<ul>
  <li>
<strong>Asset criticity</strong>: Low</li>
  <li>
<strong>Vulnerability severity</strong>: High</li>
  <li>
<strong>Bounty</strong>: More than $100</li>
</ul>

<div id="section-id-5"></div>

<h2 id="5-lessons-learned">5. Lessons learned</h2>

<ul>
  <li>
<strong>Pay attention to all subdomains, even those that may not seem important</strong>, because they can still impact other subdomains or key assets. In terms of CVSS, you could say that all subdomains should be considered, since the <em>Scope</em> component of the vulnerability might be <em>Changed</em>. For example, in this case I gained access to the internal network through a subdomain with no apparent functionality, where potentially critical assets for the company could be located.</li>
  <li>
<strong>Don’t hesitate to dive deeper into recon when necessary.</strong> In this case, I did quite a bit of recon, but since I was just starting out as a bug bounty hunter, I probably didn’t do as much as I should have. There was also the risk of being detected during exploitation, as I was interacting with internal network assets, which could lead to the vulnerability being patched before I had a chance to report it. Still, I will never know if I would have found anything important if I had done a more thorough recon.</li>
  <li>
<strong>Sometimes, while searching for or exploiting a vulnerability, you may stumble upon others that you can report separately.</strong> In this case, the main vulnerability was an SSRF, but along the way I found an exposed load balancer console that allowed modifying its configuration. I considered these to be two separate vulnerabilities with different impacts, even though the second helped me exploit the first, and I ended up getting two separate bounties. I don’t think this is common, but it’s always worth reporting both vulnerabilities properly and giving it a try.</li>
  <li>
<strong>Think carefully about how you want to approach your report.</strong> In this case, I didn’t find the impact I was hoping for, which was gaining access to one of the internal assets. However, instead of focusing on what I couldn’t do, I decided to focus on what I could do and explain that clearly. So, I reported that I could perform scans on the internal network, rather than a failed attempt to access an admin console. I didn’t get a critical, okay, but I did get a high.</li>
</ul>

        
      </section>

      <footer class="page__meta">
        
        
  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/tags/#burp-scanner" class="page__taxonomy-item" rel="tag">burp scanner</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#burpsuite" class="page__taxonomy-item" rel="tag">burpsuite</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#mod-proxy-balancer" class="page__taxonomy-item" rel="tag">mod_proxy_balancer</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#nikto" class="page__taxonomy-item" rel="tag">nikto</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#portswigger" class="page__taxonomy-item" rel="tag">portswigger</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#ssrf" class="page__taxonomy-item" rel="tag">ssrf</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#web" class="page__taxonomy-item" rel="tag">web</a>
    
    </span>
  </p>




  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/categories/#bug-bounty" class="page__taxonomy-item" rel="tag">bug bounty</a>
    
    </span>
  </p>


        
          <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2024-12-07T00:00:00+01:00">December 07, 2024</time></p>
        
      </footer>

      

      
  <nav class="pagination">
    
      <a href="/posts/2024/06/10/hackernight-2024-my-first-live-hacking-event/" class="pagination--pager" title="HackerNight 2024: my first live hacking event
">Previous</a>
    
    
      <a href="#" class="pagination--pager disabled">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
  <script src="/assets/scripts/copyCode.js"></script>

</div>

    </div>

    

    <div class="page__footer">
      <footer>
        <!-- start custom footer snippets -->
<div style="background-color: #333; padding: 20px; text-align: center;">
  <p style="color: white; font-size: 24px;">⭐ Liked this blog? Give it a <a href="https://github.com/HackCommander/hackcommander.github.io" style="color: white; font-weight: bold;">GitHub star</a>! ⭐</p>
  <p style="color: white; font-size: 24px;">🔎 Connect with me on <a href="https://www.linkedin.com/in/%E2%98%91iv%C3%A1n-santos-malpica-1023a11b4/" style="color: white; font-weight: bold;">LinkedIn</a> for more hacking and bug bounty content! 🔎</p>
  <p style="color: white; font-size: 24px;">🛍️ Interested in the products I use? Check out my <a href="https://hackcommander.github.io/advertising/" style="color: white; font-weight: bold;">recommended products</a> page for nice deals! 🛍️</p>
  <p style="color: white; font-size: 24px;">☕️ If you found this blog helpful, consider <a href="https://www.buymeacoffee.com/ivansantos" style="color: white; font-weight: bold;">buying me a coffee</a>. Thanks a latte! ☕️</p>
</div>
<!-- end custom footer snippets -->

        <div class="page__footer-follow">
  <ul class="social-icons">
    

    

    <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">© 2024 Iván Santos Malpica</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>
  <script data-search-pseudo-elements defer src="https://use.fontawesome.com/releases/v5.7.1/js/all.js" integrity="sha384-eVEQC9zshBn0rFj4+TU78eNA19HMNigMviK/PU/FFjLXqa/GKPgX58rvt5Z8PLs7" crossorigin="anonymous"></script>




<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-JGTZF7HYRM"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-JGTZF7HYRM');
</script>



  </body>
</html>
